function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function asyncGeneratorStep(e,t,r,n,a,i,s){try{var c=e[i](s),o=c.value}catch(u){return void r(u)}c.done?t(o):Promise.resolve(o).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){asyncGeneratorStep(i,n,a,s,c,"next",e)}function c(e){asyncGeneratorStep(i,n,a,s,c,"throw",e)}s(void 0)}))}}function _awaitAsyncGenerator(e){return new _AwaitValue(e)}function _wrapAsyncGenerator(e){return function(){return new _AsyncGenerator(e.apply(this,arguments))}}function _AsyncGenerator(e){var t,r;function n(t,r){try{var i=e[t](r),s=i.value,c=s instanceof _AwaitValue;Promise.resolve(c?s.wrapped:s).then((function(e){c?n("return"===t?"return":"next",e):a(i.done?"return":"normal",e)}),(function(e){n("throw",e)}))}catch(o){a("throw",o)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,a){return new Promise((function(i,s){var c={key:e,arg:a,resolve:i,reject:s,next:null};r?r=r.next=c:(t=r=c,n(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function _AwaitValue(e){this.wrapped=e}"function"==typeof Symbol&&Symbol.asyncIterator&&(_AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),_AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},_AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},_AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)},(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{ow3J:function(e,t,r){"use strict";r.r(t),r.d(t,"PageModule",(function(){return _t}));var n,a,i=r("ofXK"),s=r("3Pt+"),c=r("bTqV"),o=r("7EHt"),u=r("qFsG"),l=r("wZkO"),d=r("Wp6s"),f=r("bSwM"),g=r("0IaG"),b=r("f0Cb"),h=r("kmnG"),p=r("Xa2L"),v=r("+0xr"),y=r("MutI"),m=r("4wla"),k=r("QLJ7"),T=r("mrSG"),P=r("ODXS"),x=r("vSFt"),S=r("2Vo4"),I=r("XNiG"),w=r("vkgz"),A=r("NJ9Y"),F=r("JIr8"),C=r("LRne"),j=function(e,t){return t.some((function(t){return e instanceof t}))},D=new WeakMap,R=new WeakMap,K=new WeakMap,O=new WeakMap,M=new WeakMap,_={get:function(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return R.get(e);if("objectStoreNames"===t)return e.objectStoreNames||K.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return V(e[t])},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function z(e){_=e(_)}function V(e){if(e instanceof IDBRequest)return t=e,(r=new Promise((function(e,r){var n=function(){t.removeEventListener("success",a),t.removeEventListener("error",i)},a=function(){e(V(t.result)),n()},i=function(){r(t.error),n()};t.addEventListener("success",a),t.addEventListener("error",i)}))).then((function(e){e instanceof IDBCursor&&D.set(e,t)})).catch((function(){})),M.set(r,t),r;var t,r;if(O.has(e))return O.get(e);var i=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.apply(L(this),r),V(D.get(this))}:function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return V(t.apply(L(this),r))}:function(e){for(var r,n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];var s=(r=t).call.apply(r,[L(this),e].concat(a));return K.set(s,e.sort?e.sort():[e]),V(s)}:(e instanceof IDBTransaction&&function(e){if(!R.has(e)){var t=new Promise((function(t,r){var n=function(){e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=function(){t(),n()},i=function(){r(e.error),n()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)}));R.set(e,t)}}(e),j(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,_):e);var t}(e);return i!==e&&(O.set(e,i),M.set(i,e)),i}var L=function(e){return M.get(e)},B=["get","getKey","getAll","getAllKeys","count"],N=["put","add","delete","clear"],E=new Map;function q(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(E.get(t))return E.get(t);var r=t.replace(/FromIndex$/,""),n=t!==r,a=N.includes(r);if(r in(n?IDBIndex:IDBObjectStore).prototype&&(a||B.includes(r))){var i=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var i,s,c,o,u,l,d,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,a?"readwrite":"readonly"),c=s.store,o=f.length,u=new Array(o>1?o-1:0),l=1;l<o;l++)u[l-1]=f[l];if(n&&(c=c.index(u.shift())),d=(i=c)[r].apply(i,u),e.t0=a,!e.t0){e.next=9;break}return e.next=9,s.done;case 9:return e.abrupt("return",d);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return E.set(t,i),i}}}z((function(e){return{get:function(t,r,n){return q(t,r)||e.get(t,r,n)},has:function(t,r){return!!q(t,r)||e.has(t,r)}}}));var U=["continue","continuePrimaryKey","advance"],G={},H=new WeakMap,Q=new WeakMap,J={get:function(e,t){if(!U.includes(t))return e[t];var r=G[t];return r||(r=G[t]=function(){var e;H.set(this,(e=Q.get(this))[t].apply(e,arguments))}),r}};function W(){return X.apply(this,arguments)}function X(){return(X=_wrapAsyncGenerator(regeneratorRuntime.mark((function e(){var t,r,n,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,e.t0=r instanceof IDBCursor,e.t0){e.next=6;break}return e.next=5,_awaitAsyncGenerator((t=r).openCursor.apply(t,a));case 5:r=e.sent;case 6:if(r){e.next=8;break}return e.abrupt("return");case 8:r=r,n=new Proxy(r,J),Q.set(n,r),M.set(n,L(r));case 11:if(!r){e.next=20;break}return e.next=14,n;case 14:return e.next=16,_awaitAsyncGenerator(H.get(n)||r.continue());case 16:r=e.sent,H.delete(n);case 18:e.next=11;break;case 20:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function Y(e,t){return t===Symbol.asyncIterator&&j(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&j(e,[IDBIndex,IDBObjectStore])}z((function(e){return{get:function(t,r,n){return Y(t,r)?W:e.get(t,r,n)},has:function(t,r){return Y(t,r)||e.has(t,r)}}}));var Z,ee,te=r("h2Ed"),re=r("tk/3"),ne=r("fXoL"),ae=r("EnSQ"),ie=r("c3AT"),se=r("2uAV"),ce=r("i6c7"),oe=r("flj8"),ue=r("YiK1"),le=r("tyNb"),de=((ee=function(){function e(t,r,n,a,i,s,c,o){var u=this;_classCallCheck(this,e),this.dataService=t,this.projectService=r,this.infoService=n,this.taskService=a,this.accountService=i,this.systemService=s,this.http=c,this.router=o,this.client$=new S.a(null),this.currentProject$=new S.a(null),this.currentResult$=new S.a(null),this.currentDataFile$=new S.a(null),this.currentPackages$=new S.a([]),this.currentPackageID="",this.currentUser$=new S.a(null),this.currentIndexedDB$=new S.a(null),this.entryType$=new S.a(null),this.currentPageKey$=new S.a(null),this.requestNavigation$=new I.a,this.isFullPage$=new S.a(!1),this.showRightMenu$=new S.a(!0),this.pageMode$=new S.a("page"),this.refresh$=new I.a,this.logItems=[],this.currentPageKey$.subscribe((function(e){if(e&&e.split){var t=e.split(":");Array.isArray(t)&&2===t.length&&(u.currentPackageID=t[0])}}))}return _createClass(e,[{key:"_logItem",value:function(e){var t={};t[e.type]=e,this.logItems.push(t)}},{key:"_sleep",value:function(e){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout((function(){return t()}),e)})));case 1:case"end":return t.stop()}}),t)})))}},{key:"sendToClient",value:function(e){e.type=e.type||"received",this._logItem(e);try{this.client$.getValue().nativeElement.contentWindow.postMessage(e,"*")}catch(t){try{this.client$.getValue().nativeElement.contentWindow.postMessage(JSON.parse(JSON.stringify(e)),"*")}catch(t){console.log(t)}}}},{key:"_requestIDB",value:function(e,t,r,n){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=t||1,console.log("open database: "+e),a.next=4,function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.blocked,a=r.upgrade,i=r.blocking,s=indexedDB.open(e,t),c=V(s);return a&&s.addEventListener("upgradeneeded",(function(e){a(V(s.result),e.oldVersion,e.newVersion,V(s.transaction))})),n&&s.addEventListener("blocked",(function(){return n()})),i&&c.then((function(e){return e.addEventListener("versionchange",i)})).catch((function(){})),c}(e,t,{upgrade:function(e){for(var t=0,a=Object.keys(r);t<a.length;t++){var i=a[t],s=e.createObjectStore(i,r[i]);if(n&&n[i]){var c=n[i];s.createIndex(c.indexName,c.keyPath,c.objectParameters)}}}});case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}}),a)})))}},{key:"_changeMode",value:function(e){var t=this.pageMode$.getValue();void 0===e&&(e="list"===t?"page":"list"),this.pageMode$.next("list"===e?"list":"page")}},{key:"_toggleFullPage",value:function(e){var t=!this.isFullPage$.getValue();this.isFullPage$.next(void 0===e?t:e)}},{key:"isValidAPI",value:function(e){return!(["constructor","_logItem","sendToClient","_sleep","_changeMode","_toggleFullPage"].indexOf(e)>=0)&&void 0!==this[e]&&"function"==typeof this[e]}},{key:"historyBack",value:function(){window.history.go(-1)}},{key:"historyForward",value:function(){window.history.go(1)}},{key:"log",value:function(e,t){this.logItems.push({log:JSON.parse(JSON.stringify(t))})}},{key:"handshake",value:function(e,t){this.sendToClient({id:e,call:"handshake"})}},{key:"getAuthToken",value:function(e){var t=this,r=this.accountService.getAuthToken().subscribe((function(n){return r.unsubscribe(),t.sendToClient(n.isError?{call:"getAuthToken",id:e,value:null}:{call:"getAuthToken",id:e,value:n.success})}))}},{key:"listFiles",value:function(e){var t=this.currentProject$.getValue();this.sendToClient({call:"listFiles",id:e,value:t&&Array.isArray(t.dataFiles)?t.dataFiles.map((function(e){return e.getModel()})):[]})}},{key:"listResults",value:function(e){var t=this.currentProject$.getValue();this.sendToClient({call:"listResults",id:e,value:t&&Array.isArray(t.results)?t.results.map((function(e){return e.getModel()})):[]})}},{key:"listTasks",value:function(e,t){var r=this,n=this.taskService.getTasks(t.packageID||this.currentPackageID,t.only).subscribe((function(t){n.unsubscribe(),r.sendToClient({id:e,call:"listTasks",type:"received",value:Array.isArray(t.success)?t.success.map((function(e){return e.getModel()})):[]})}))}},{key:"listPackages",value:function(e){var t=this,r=this.projectService.getRelatedPackages().subscribe((function(n){r.unsubscribe(),t.sendToClient({id:e,call:"listPackages",type:"received",value:Array.isArray(n.success)?n.success.map((function(e){return e.getModel()})):[]})}))}},{key:"listAllTasks",value:function(e){var t=this,r=this.currentProject$.getValue().packages;if(Array.isArray(r))var n=this.taskService.getTasks(r.map((function(e){return e.id})).join(",")).subscribe((function(r){n.unsubscribe(),t.sendToClient({id:e,call:"listAllTasks",type:"received",value:Array.isArray(r.success)?r.success.map((function(e){return e.getModel()})):[]})}))}},{key:"getCurrentUserInfo",value:function(e){var t=this.currentUser$.getValue();this.sendToClient({id:e,call:"getCurrentUserInfo",type:"received",value:t&&t.getModel?t.getModel():{}})}},{key:"getCurrentFileInfo",value:function(e){var t=this.currentDataFile$.getValue();this.sendToClient({id:e,call:"getCurrentFileInfo",type:"received",value:t?t.getModel():null})}},{key:"getCurrentResultInfo",value:function(e){var t=this.currentResult$.getValue();if(!t)return this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:null});var r=t.getModel();if("workflow"!==t.type)this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:r});else{for(var n=this.currentProject$.getValue(),a=n.results.map((function(e){return e.id})),i=[],s=t.children,c=0;c<s.length;c++)if(i[c]=[],Array.isArray(s[c]))for(var o=0;o<s[c].length;o++){var u=a.indexOf(s[c][o]);i[c][o]=u>=0&&n.results[u]&&n.results[u].parent===t.id?n.results[u].getModel():{}}r.children=i,this.sendToClient({id:e,call:"getCurrentResultInfo",type:"received",value:r})}}},{key:"getCurrentPackageInfo",value:function(e){var t=this.currentPackages$.getValue(),r=this.currentPackageID,n=t.filter((function(e){return e.id===r}));this.sendToClient({id:e,call:"getCurrentPackageInfo",type:"received",value:n.length>0?n[0].getModel():{}})}},{key:"getCurrentProjectInfo",value:function(e){var t=this.currentProject$.getValue();this.sendToClient({id:e,call:"getCurrentProjectInfo",type:"received",value:t?t.getModel():{}})}},{key:"getTaskArguments",value:function(e,t){var r=this,n=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe((function(a){if(n.unsubscribe(),a.isError)return r.sendToClient({id:e,call:"getTaskArguments",type:"error",value:JSON.stringify(a.errors)});var i=t.identifier,s=a.success.filter((function(e){return e.id===i||e.key===i}))[0];if(!s)return r.sendToClient({id:e,call:"getTaskArguments",type:"error",value:"There is no such task with the id/key: "+i}),r.sendToClient({id:e,call:"getTaskArguments",type:"received",value:[]});r.sendToClient({id:e,call:"getTaskArguments",type:"received",value:s.arguments.map((function(e){return e.getModel()}))})}))}},{key:"getTaskInfo",value:function(e,t){var r=this,n=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe((function(a){if(n.unsubscribe(),a.isError)return r.sendToClient({id:e,call:"getTaskInfo",type:"error",value:JSON.stringify(a.errors)});var i=t.identifier,s=a.success.filter((function(e){return e.id===i||e.key===i}))[0];if(!s)return r.sendToClient({id:e,call:"getTaskInfo",type:"error",value:"There is no such task with the id/key: "+i}),r.sendToClient({id:e,call:"getTaskInfo",type:"received",value:{}});r.sendToClient({id:e,call:"getTaskInfo",type:"received",value:s.getModel()})}))}},{key:"getTaskInputGuide",value:function(e,t){var r=this,n=t.identifier,a=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe((function(t){if(a.unsubscribe(),t.isError)return r.sendToClient({id:e,call:"getTaskInputGuide",type:"error",value:JSON.stringify(t.errors)});var i=t.success,s=r.currentProject$.getValue(),c=i.filter((function(e){return e.id===n||e.key===n}))[0];if(!c)return r.sendToClient({id:e,call:"getTaskInputGuide",type:"error",value:"There is no such task with the id/key: "+n}),r.sendToClient({id:e,call:"getTaskInputGuide",type:"received",value:[]});var o=r.taskService.taskValidInputs$.subscribe((function(t){o.unsubscribe();var n=c.arguments.map((function(e){return"outFile"===e.type?null:e.getModel()}));t.forEach((function(e){var t=e.index;n[t]&&"inFile"===n[t].type&&(n[t].candidates=e.models.map((function(e){return e.getModel()})))}));var a=c.arguments.filter((function(e){return"outFile"===e.type})).map((function(e){return e.getModel()}));r.sendToClient({id:e,call:"getTaskInputGuide",type:"received",value:{inputs:n,outputs:a}})}));r.taskService.getValidInputFile(c.id,s.id)}))}},{key:"executeTask",value:function(e,t){var r=this,n=t.identifier,a=t.resultInfo,i=t.inputs,s=t.outputs,c=[],o=this.taskService.getTasks(t.packageID||this.currentPackageID,!0).subscribe((function(t){o.unsubscribe();var u=t.success,l=r.currentProject$.getValue(),d=u.filter((function(e){return e.id===n||e.key===n}))[0];return d?i.length!==d.arguments.length?(r.sendToClient({id:e,call:"executeTask",type:"error",value:"The length of inputs does not match the length of the task arguments."}),r.sendToClient({id:e,call:"executeTask",type:"received",value:{}})):(d.arguments.forEach((function(e,t){switch(e.type){case"static":i[t]=e.default[0];break;case"value":i[t]=String(null==i[t]?e.default[0]:i[t]);break;case"list":Array.isArray(i[t])||(i[t]=[i[t]]),i[t]=i[t].filter((function(t){return e.list.indexOf(t)>=0})),e.multiple||(i[t]=[i[t][0]]),0===i[t].filter((function(e){return null!=e})).length&&c.push({index:t,error:"No valid items to select"});break;case"inFile":var r=l.dataFiles.filter((function(e){return e.id===i[t]}))[0];if(r){var n=e.isValidFile(r);n.result||c.push({index:t,error:n.reason})}else e.optional||c.push({index:t,error:"No valid file selected"});break;case"outFile":i[t]=null}})),c.length>0?(r.sendToClient({id:e,call:"executeTask",type:"error",value:c}),r.sendToClient({id:e,call:"executeTask",type:"received",value:{}})):(a.prefix=String(a.prefix)||"",a.suffix=String(a.suffix)||"",d.arguments.filter((function(e){return"outFile"===e.type})).forEach((function(e,t){s[t]?(s[t].name=void 0!==s[t].name?String(s[t].name):e.name,s[t].desc=void 0!==s[t].desc?String(s[t].desc):"",s[t].prefix=void 0!==s[t].prefix?String(s[t].prefix):a.prefix,s[t].suffix=void 0!==s[t].suffix?String(s[t].suffix):a.suffix):s[t]={name:e.name,desc:"",prefix:a.prefix,suffix:a.suffix}})),a.name=a&&void 0!==a.name?String(a.name):"Result from "+d.name,a.desc=a&&void 0!==a.desc?String(a.desc):"",a.name=a.name.slice(0,160),a.desc=a.desc.slice(0,500),a.prefix=a.prefix.slice(0,160),a.suffix=a.suffix.slice(0,160),void r.projectService.createResult(d.id,{run:!0,projectID:l.id,inputs:i,outputs:s,name:a.name,desc:a.desc,prefix:a.prefix||"",suffix:a.suffix||""}).subscribe((function(t){return t.isError?(t.errors.forEach((function(t){r.sendToClient({id:e,call:"executeTask",type:"error",value:t})})),r.sendToClient({id:e,call:"executeTask",type:"received",value:{}})):r.sendToClient({id:e,call:"executeTask",type:"received",value:t.success.getModel()})})))):(r.sendToClient({id:e,call:"executeTask",type:"error",value:"There is no such task with the id/key: "+n}),r.sendToClient({id:e,call:"executeTask",type:"received",value:{}}))}))}},{key:"updateResultInfo",value:function(e,t){var r=this,n=this.currentProject$.getValue();if(!n)return this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:"No project to update the Result information."});var a=t.resultID,i=t.newInfo,s=n.results.filter((function(e){return e.id===a}))[0];if(!s)return this.sendToClient({id:e,call:"updateResultInfo",type:"error",value:"Cannot find any Result with this Result ID (".concat(a,") to update its information.")});var c=new P.a({id:a,name:i.name||s.name,prefix:i.prefix||s.prefix,suffix:i.suffix||s.suffix,desc:i.desc||s.desc});this.projectService.updateResultInfo(c).subscribe((function(t){return t.isError?t.errors.forEach((function(t){return r.sendToClient({id:e,call:"updateResultInfo",type:"error",value:t})})):r.sendToClient({id:e,call:"updateResultInfo",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})}))}},{key:"deleteResult",value:function(e,t){var r=this;this.projectService.deleteResult(new P.a({id:t.resultID})).subscribe((function(t){return t.isError?t.errors.forEach((function(t){return r.sendToClient({id:e,call:"deleteResult",type:"error",value:t})})):r.sendToClient({id:e,call:"deleteResult",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})}))}},{key:"getFileBlob",value:function(e,t){var r=this,n=t.fileID,a=t.subPath||void 0,i=this.currentProject$.getValue().dataFiles.filter((function(e){return e.id===n}))[0];a&&"Folder"!==i.format&&(a=void 0);var s=this.dataService.downloadAsFileBlob(n,a).pipe(Object(w.a)((function(t){r.sendToClient({id:e,call:"getFileBlob",type:"event",value:t})})),Object(A.a)(),Object(F.a)((function(t){return console.log(t),r._logItem({id:e,call:"getFileBlob",type:"log",value:t.toString()}),Object(C.a)({body:void 0})}))).subscribe((function(t){s.unsubscribe(),r.sendToClient({id:e,call:"getFileBlob",type:"received",value:t.body})}))}},{key:"getDownloadLink",value:function(e,t){var r=t.fileID,n=t.subPath,a=t.authToken,i=this.currentProject$.getValue().dataFiles.filter((function(e){return e.id===r}))[0];if(!i)return this._logItem({id:e,call:"getDownloadLink",type:"error",value:"This DataFile ID: ".concat(r," is invalid.")}),this.sendToClient({id:e,call:"getDownloadLink",type:"received",value:null});if(a){if("Folder"===i.format&&n){var s=n.split("/").map(encodeURIComponent).join("/");return this.sendToClient({call:"getDownloadLink",id:e,value:"/data/static/".concat(r,"/").concat(s,"?authToken=").concat(a)})}return this.sendToClient({call:"getDownloadLink",id:e,value:"/data/api/dataFile/".concat(r,"/download?authToken=").concat(a)})}return this._logItem({id:e,call:"getDownloadLink",type:"error",value:"The authToken is unset. You have to call getAuthToken() to get the authToken."}),this.sendToClient({call:"getDownloadLink",id:e,value:null})}},{key:"globFilesInFolder",value:function(e,t){var r=this,n=t.fileID,a=this.currentProject$.getValue(),i=t.globbyExprs,s=!1;if(a.dataFiles.filter((function(e){return e.id===n&&"Folder"===e.format})).length>0||(this._logItem({id:e,call:"globFilesInFolder",type:"error",value:"This DataFile ID: ".concat(n," is not a folder")}),s=!0),Array.isArray(i)||(this._logItem({id:e,call:"globFilesInFolder",type:"error",value:"The globbyExprs is not an array."}),s=!0),s)return this.sendToClient({id:e,call:"globFilesInFolder",type:"received",value:null});var c=this.dataService.globbyFilesInFolder(n,i).subscribe((function(t){c.unsubscribe(),r.sendToClient({id:e,call:"globFilesInFolder",type:"received",value:t.success})}))}},{key:"importFileFromPath",value:function(e,t){var r=this,n=this.currentProject$.getValue(),a=t.options,i=Array.isArray(a.tags)?a.tags:[],s=this.projectService.importFromPath(t.path,n.id,t.makeSymbolicLink,a.name,a.desc,a.prefix,a.suffix,i,a.folder,a.keepFileName).subscribe((function(t){return s.unsubscribe(),t.isError?t.errors.forEach((function(t){return r.sendToClient({id:e,call:"importFileFromPath",type:"error",value:t})})):r.sendToClient({id:e,call:"importFileFromPath",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})}))}},{key:"uploadFiles",value:function(e,t,r){var n=this,a=this.currentPackages$.getValue(),i=this.currentProject$.getValue(),s=t.options,c=[];Array.from(t.files).forEach((function(t,i){if(!(t instanceof File||t instanceof Blob)){var o=String(1+i);switch(o){case"1":o+="st";break;case"2":o+="nd";break;case"3":o+="rd";break;default:o+="th"}return n.sendToClient({id:e,call:r||"uploadFiles",type:"error",value:"The "+o+" file has wrong type. Should be File or Blob type."})}var u;t instanceof File&&(u=a.map((function(e){return e.checkAllowedFormat(t.name)}))),!u&&t instanceof Blob&&(u=a.map((function(e){return e.checkAllowedFormat(s.name+"."+s.format)})));var l=[].concat.apply([],a.map((function(e){return e.allowedFormats})));if(0===(u=u.filter((function(e){return!!e}))).length)return n.sendToClient({id:e,call:r||"uploadFiles",type:"error",value:"The "+(i+1)+" file has wrong file extension. The allowed formats are: "+l.join(", ")});c.push(t)}));var o=Array.isArray(s.tags)?s.tags.map((function(e){return e.toLowerCase().replace(/[^a-zA-Z0-9\.\-\_]/g,"").trim()})):[],u=s.folderID,l=s.keepFileName;if(1!==i.dataFiles.filter((function(e){return e.id===u&&"Folder"===e.format})).length&&(l=void 0,u=void 0),0===c.length)return this.sendToClient({id:e,call:r||"uploadFiles",type:"error",value:"No File item to upload"});var d=this.dataService.uploadFiles(i.id,c,{name:s.name,prefix:s.prefix,suffix:s.suffix,folder:u,keepFileName:l,desc:s.desc||"",format:s.format,tags:o}).pipe(Object(w.a)((function(t){n.sendToClient({id:e,call:r||"uploadFiles",type:"event",value:t})})),Object(A.a)(),Object(F.a)((function(t){return n._logItem({id:e,call:r||"uploadFiles",type:"log",value:t.toString()}),Object(C.a)({body:void 0})}))).subscribe((function(t){if(d.unsubscribe(),t.body){var a=new te.a(t.body);a.isError&&(n.infoService.addMessages(a.errors),a.errors.forEach((function(t){return n.sendToClient({id:e,call:r||"uploadFiles",type:"error",value:t})}))),n.sendToClient({id:e,call:r||"uploadFiles",type:"received",value:a.success.map((function(e){return new x.a(e).getModel()}))})}}))}},{key:"uploadFileBlob",value:function(e,t){this.uploadFiles(e,{files:[t.fileBlob],options:{name:t.name,prefix:t.prefix,suffix:t.suffix,desc:t.desc,tags:t.tags,folderID:t.folderID,format:t.format||"",keepFileName:!!t.keepFileName}},"uploadFileBlob")}},{key:"createFolder",value:function(e,t){var r=this,n=this.currentProject$.getValue();if(!n)return this.sendToClient({id:e,call:"createFolder",type:"error",value:"No project to create the folder."});var a=t.name||"a folder",i=t.desc||"",s=t.prefix||"",c=t.suffix||"",o=Array.isArray(t.tags)?t.tags:[];this.projectService.createFolder(n.id,a,i,s,c,o,t.folderId,t.keepFileName).subscribe((function(t){return!t.isError&&r.sendToClient({id:e,call:"createFolder",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})}))}},{key:"updateFileInfo",value:function(e,t){var r=this,n=this.currentProject$.getValue();if(!n)return this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:"No project to update the DataFile record."});var a=t.fileID,i=t.newInfo,s=n.dataFiles.filter((function(e){return e.id===a}))[0];if(!s)return this.sendToClient({id:e,call:"updataFileInfo",type:"error",value:"Cannot find any DataFile with this file ID (".concat(a,") to update the information.")});if(Array.isArray(i.tags)){i.tags=i.tags.map((function(e){return"Folder"===e?e:e.toLowerCase().replace(/[^a-zA-Z0-9\.\-\_]/g,"")})).filter((function(e){return!!e}));var c=i.tags.indexOf("Folder"),o=s.tags.indexOf("Folder");o>=0&&-1===c?i.tags.unshift("Folder"):-1===o&&c>=0&&i.tags.splice(c,1)}else i.tags=s.tags.slice();var u=new x.a({id:a,name:i.name||s.name,prefix:i.prefix||s.prefix,suffix:i.suffix||s.suffix,desc:i.desc||s.desc,tags:i.tags});this.projectService.updateDataFileInfo(u).subscribe((function(t){return t.isError?t.errors.forEach((function(t){return r.sendToClient({id:e,call:"updataFileInfo",type:"error",value:t})})):r.sendToClient({id:e,call:"updataFileInfo",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})}))}},{key:"deleteFile",value:function(e,t){var r=this;this.projectService.deleteDataFile(new x.a({id:t.fileID})).subscribe((function(t){return t.isError?t.errors.forEach((function(t){return r.sendToClient({id:e,call:"deleteFile",type:"error",value:t})})):r.sendToClient({id:e,call:"deleteFile",type:"received",value:t.success&&t.success.getModel?t.success.getModel():{}})}))}},{key:"_navigatePage",value:function(e,t,r,n){r=r||null,n=n||this.currentPackageID||null;var a=this.currentProject$.getValue();!n&&Array.isArray(a.packages)&&a.packages[0]&&a.packages[0].id&&(n=n||a.packages[0].id),(r=r&&n?n+":"+r:null)&&this.requestNavigation$.next({itemID:e,type:t,pageKey:r})}},{key:"navigateToProjectList",value:function(e,t){t||(t={listType:"myProjects",pageSize:30,pageIndex:0}),this.router.navigate(["/project/list"],{queryParams:{listType:t.listType||"myProjects",pageSize:t.pageSize||30,pageIndex:t.pageIndex||0}})}},{key:"navigateToProjectPage",value:function(e,t){this._navigatePage(this.currentProject$.getValue().id,"project",t.pageKey||null,t.packageID||null)}},{key:"navigateToFilePage",value:function(e,t){this._navigatePage(t.fileID,"datafile",t.pageKey||null,t.packageID||null)}},{key:"navigateToBdpDataFile",value:function(e,t){this.router.navigate(["/dataFile",t.fileID,"info"])}},{key:"navigateToResultPage",value:function(e,t){this._navigatePage(t.resultID,"result",t.pageKey||null,t.packageID||null)}},{key:"navigateToBdpResult",value:function(e,t){this.router.navigate(["/result",t.resultID,"info"])}},{key:"openFileLink",value:function(e,t){return window.open("/dataFile/"+t.fileID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openFileLink",type:"received",value:t.fileID})}},{key:"openResultLink",value:function(e,t){return window.open("/result/"+t.resultID+"/info","","width=1024,height=768"),this.sendToClient({id:e,call:"openResultLink",type:"received",value:t.resultID})}},{key:"requestHttp",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a,i,s,c,o,u,l,d,f,g,b,h=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.path.match(/^\//)){r.next=2;break}return r.abrupt("return",this.sendToClient({id:e,call:"requestHttp",type:"error",value:"Invalid path to request server. You are supposed to request paths which begins with '/'."}));case 2:if(n=t.method.toUpperCase(),a=t.httpOptions.queryParams||null,i=t.httpOptions.headers||null,s=new re.e,c=new re.d,a)for(o=Object.keys(a),u=0;u<o.length;u++)l=o[u],s=s.set(l,a[l]);if(i)for(d=Object.keys(i),f=0;f<d.length;f++)g=d[f],c=c.set(g,i[g]);b=this.http.request(n,t.path,{body:t.httpOptions.requestBody||null,headers:c,observe:t.httpOptions.observe,params:s,withCredentials:!0,reportProgress:!!t.httpOptions.reportProgress,responseType:t.httpOptions.responseType}).pipe(Object(w.a)((function(t){return h.sendToClient({id:e,call:"requestHttp",type:"event",value:t})})),Object(A.a)(),Object(F.a)((function(t){return h.sendToClient({id:e,call:"requestHttp",type:"error",value:""+JSON.stringify(t)}),Object(C.a)(null)}))).subscribe((function(t){b.unsubscribe(),h.sendToClient({id:e,call:"requestHttp",type:"received",value:t})}));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"requestDatabase",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a,i,s,c,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=this.entryType$.getValue(),a=this.currentPageKey$.getValue(),i=this.currentUser$.getValue(),s="filePages"===n?this.currentDataFile$.getValue().id:"resultPages"===n?this.currentResult$.getValue().id:this.currentProject$.getValue().id,c="".concat(i.id,"-").concat(n,"-").concat(s,"-").concat(a),r.prev=1,r.next=4,this._requestIDB(c,t.version,t.objectStoreSettings,t.creatingIndexes);case 4:o=r.sent,this.currentIndexedDB$.next(o),this.sendToClient({id:e,call:"requestDatabase",type:"received",value:"ok"}),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),this.sendToClient({id:e,call:"requestDatabase",type:"error",value:"Failed to create DB: ".concat(c,"; \nerrors: ").concat(JSON.parse(JSON.stringify(r.t0)))});case 11:case"end":return r.stop()}}),r,this,[[1,8]])})))}},{key:"requestDatabaseRemove",value:function(e){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,a,i,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.currentIndexedDB$.getValue(),n=this.currentUser$.getValue(),a=this.entryType$.getValue(),i=this.currentPageKey$.getValue(),r){t.next=3;break}return t.abrupt("return");case 3:if(s="filePages"===a?this.currentDataFile$.getValue().id:"resultPages"===a?this.currentResult$.getValue().id:this.currentProject$.getValue().id,c="".concat(n.id,"-").concat(a,"-").concat(s,"-").concat(i),t.t0=r&&r.close,!t.t0){t.next=9;break}return r.close(),t.next=9,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.blocked,n=indexedDB.deleteDatabase(e);return r&&n.addEventListener("blocked",(function(){return r()})),V(n).then((function(){}))}(c);case 9:this.sendToClient({id:e,call:"requestDatabaseRemove",type:"received",value:"ok"});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"setDataStore",value:function(){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"dataStoreCount",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=this.currentIndexedDB$.getValue()){r.next=3;break}return r.abrupt("return");case 3:return r.next=5,n.count(t.storeName,t.queryKeyRange);case 5:return a=r.sent,r.abrupt("return",this.sendToClient({id:e,call:"dataStoreCount",type:"received",value:a}));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"dataStoreAdd",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a,i,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=this.currentIndexedDB$.getValue()){r.next=3;break}return r.abrupt("return");case 3:if(a=t.dataItems,i=t.dataKeys||void 0,!Array.isArray(a)){r.next=16;break}return r.prev=5,s=n.transaction(t.storeName,"readwrite"),a.forEach((function(e,t){return i&&i[t]?s.store.add(e,i[t]):s.store.add(e)})),r.next=10,s.done;case 10:this.sendToClient({id:e,call:"dataStoreAdd",type:"received",value:"ok"}),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(5),this.sendToClient({id:e,call:"dataStoreAdd",type:"error",value:"There are errors when adding data to the objectStore."});case 16:case"end":return r.stop()}}),r,this,[[5,13]])})))}},{key:"dataStorePut",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a,i,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=this.currentIndexedDB$.getValue()){r.next=3;break}return r.abrupt("return");case 3:if(a=t.dataItems,i=t.dataKeys||void 0,!Array.isArray(a)){r.next=10;break}return s=n.transaction(t.storeName,"readwrite"),a.forEach((function(e,t){return i&&i[t]?s.store.put(e,i[t]):s.store.put(e)})),r.next=9,s.done;case 9:return r.abrupt("return",this.sendToClient({id:e,call:"dataStorePut",type:"received",value:"ok"}));case 10:case"end":return r.stop()}}),r,this)})))}},{key:"dataStoreQuery",value:function(e,t){var r,n;return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s,c,o,u,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=this.currentIndexedDB$.getValue()){a.next=3;break}return a.abrupt("return");case 3:if(s=i.transaction(t.storeName),null==t.indexName){a.next=32;break}c=s.store.index(t.indexName),a.prev=6,u=Object(T.a)(c.iterate(t.query));case 8:return a.next=10,u.next();case 10:if((o=a.sent).done){a.next=14;break}this.sendToClient({id:e,call:"dataStoreQuery",type:"event",value:o.value.value});case 12:a.next=8;break;case 14:a.next=19;break;case 16:a.prev=16,a.t0=a.catch(6),r={error:a.t0};case 19:if(a.prev=19,a.prev=20,a.t1=o&&!o.done&&(n=u.return),!a.t1){a.next=25;break}return a.next=25,n.call(u);case 25:if(a.prev=25,!r){a.next=28;break}throw r.error;case 28:return a.finish(25);case 29:return a.finish(19);case 30:a.next=42;break;case 32:return a.next=34,s.store.openCursor(t.query);case 34:l=a.sent;case 35:if(!l){a.next=42;break}return this.sendToClient({id:e,call:"dataStoreQuery",type:"event",value:l.value}),a.next=39,l.continue();case 39:l=a.sent;case 40:a.next=35;break;case 42:this.sendToClient({id:e,call:"dataStoreQuery",type:"received",value:"ok"});case 43:case"end":return a.stop()}}),a,this,[[6,16,19,30],[20,,25,29]])})))}},{key:"dataStoreGet",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,a,i,s,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=this.currentIndexedDB$.getValue()){r.next=3;break}return r.abrupt("return");case 3:if(a=t.indexName,i=t.storeName,s=t.key,null!=a){r.next=17;break}if(null!=s){r.next=11;break}return r.next=8,n.getAll(i);case 8:r.t1=r.sent,r.next=14;break;case 11:return r.next=13,n.get(i,s);case 13:r.t1=r.sent;case 14:r.t0=r.t1,r.next=27;break;case 17:if(null!=s){r.next=23;break}return r.next=20,n.getAllFromIndex(i,a);case 20:r.t2=r.sent,r.next=26;break;case 23:return r.next=25,n.getFromIndex(i,a,s);case 25:r.t2=r.sent;case 26:r.t0=r.t2;case 27:c=r.t0,this.sendToClient({id:e,call:"dataStoreGet",type:"received",value:c});case 29:case"end":return r.stop()}}),r,this)})))}},{key:"dataStoreGetAllKey",value:function(){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"dataStoreClear",value:function(e,t){return Object(T.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=this.currentIndexedDB$.getValue())try{n.clear(t.storeName),this.sendToClient({id:e,call:"dataStoreClear",type:"received",value:"ok"})}catch(a){this.sendToClient({id:e,call:"dataStoreClear",type:"error",value:""+JSON.parse(JSON.stringify(a))})}case 2:case"end":return r.stop()}}),r,this)})))}},{key:"refreshPage",value:function(e){this.refresh$.next(!0),this.sendToClient({id:e,call:"refreshPage",type:"received",value:"ok"})}},{key:"toggleFullPage",value:function(e,t){var r=this;this._toggleFullPage(t.isFullPage),setTimeout((function(){return r.sendToClient({id:e,call:"toggleFullPage",type:"received",value:t.isFullPage})}),200)}},{key:"toggleRightSideMenu",value:function(e,t){var r=this;this.showRightMenu$.next(!!t.isShown),setTimeout((function(){return r.sendToClient({id:e,call:"toggleRightSideMenu",type:"received",value:t.isShown})}),200)}},{key:"togglePageList",value:function(e,t){var r=this;["list","page"].indexOf(t.mode)>=0?this._changeMode(t.mode):this._changeMode(),setTimeout((function(){return r.sendToClient({id:e,call:"togglePageList",type:"received",value:r.pageMode$.getValue()})}),10)}}]),e}()).\u0275fac=function(e){return new(e||ee)(ne.Xb(ae.a),ne.Xb(ie.a),ne.Xb(se.a),ne.Xb(ce.a),ne.Xb(oe.a),ne.Xb(ue.a),ne.Xb(re.a),ne.Xb(le.c))},ee.\u0275prov=ne.Jb({token:ee,factory:ee.\u0275fac,providedIn:"root"}),ee),fe=((Z=function e(){_classCallCheck(this,e)}).\u0275mod=ne.Lb({type:Z}),Z.\u0275inj=ne.Kb({factory:function(e){return new(e||Z)},providers:[de],imports:[[s.d,i.c,c.c,b.b,o.b,f.b,h.d,d.h,g.f,v.o,y.d,p.b,m.a,k.b]]}),Z),ge=r("RMCY"),be=r("44fm"),he=r("FKr1");function pe(e,t){1&e&&(ne.Tb(0,"span"),ne.Kc(1,"Project Page"),ne.Sb())}function ve(e,t){1&e&&(ne.Tb(0,"span"),ne.Kc(1,"Result Page"),ne.Sb())}function ye(e,t){1&e&&(ne.Tb(0,"span"),ne.Kc(1,"Project Page"),ne.Sb())}function me(e,t){1&e&&(ne.Tb(0,"span"),ne.Kc(1,"DataFile Page"),ne.Sb())}function ke(e,t){1&e&&(ne.Tb(0,"span"),ne.Kc(1,"Static Page"),ne.Sb())}function Te(e,t){if(1&e&&(ne.Tb(0,"h2"),ne.Kc(1,"Page type: "),ne.Ic(2,pe,2,0,"span",2),ne.Ic(3,ve,2,0,"span",2),ne.Ic(4,ye,2,0,"span",2),ne.Ic(5,me,2,0,"span",2),ne.Ic(6,ke,2,0,"span",2),ne.Sb()),2&e){var r=ne.fc();ne.Ab(2),ne.mc("ngIf","indexPages"===r.entryType),ne.Ab(1),ne.mc("ngIf","resultPages"===r.entryType),ne.Ab(1),ne.mc("ngIf","proxyPages"===r.entryType),ne.Ab(1),ne.mc("ngIf","filePages"===r.entryType),ne.Ab(1),ne.mc("ngIf","staticPages"===r.entryType)}}var Pe,xe=((Pe=function(){function e(t,r){_classCallCheck(this,e),this.dialogRef=t,this.data=r,this.authorizedList={"allow-forms":!1,"allow-modals":!1,"allow-popups":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-same-origin":!1,"allow-scripts":!1,"allow-downloads":!1};for(var n=r.authorizedList,a=Object.keys(this.authorizedList),i=0;i<a.length;i++){var s=a[i];this.authorizedList[s]=n.indexOf(s)>=0}this.entryType=r.entryType}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"save",value:function(){var e=this,t=Object.keys(this.authorizedList).filter((function(t){return!0===e.authorizedList[t]}));this.dialogRef.close(t)}}]),e}()).\u0275fac=function(e){return new(e||Pe)(ne.Nb(g.g),ne.Nb(g.a))},Pe.\u0275cmp=ne.Hb({type:Pe,selectors:[["authorize-sandbox"]],decls:65,vars:13,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-subheader",""],["mat-line","",3,"ngModel","disabled","ngModelChange"],["mat-line","",1,"ml-4"],["mat-line","",1,"ml-4","text-muted"],["mat-line","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-button","",3,"click"]],template:function(e,t){1&e&&(ne.Tb(0,"h1",0),ne.Kc(1,"Authorizing Page sandbox options"),ne.Sb(),ne.Tb(2,"div",1),ne.Ic(3,Te,7,5,"h2",2),ne.Tb(4,"mat-list"),ne.Tb(5,"h3",3),ne.Kc(6,"The default authorized options"),ne.Sb(),ne.Tb(7,"mat-list-item"),ne.Tb(8,"mat-checkbox",4),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-scripts"]=e})),ne.Kc(9,"Allow Scripts"),ne.Sb(),ne.Tb(10,"span",5),ne.Kc(11,"Page can execute javascripts."),ne.Sb(),ne.Sb(),ne.Tb(12,"mat-list-item"),ne.Tb(13,"mat-checkbox",4),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-modals"]=e})),ne.Kc(14,"Allow Modal"),ne.Sb(),ne.Tb(15,"span",5),ne.Kc(16,"Page can create modal windows."),ne.Sb(),ne.Sb(),ne.Tb(17,"mat-list-item"),ne.Tb(18,"mat-checkbox",4),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-popups"]=e})),ne.Kc(19,"Allow Pop-ups"),ne.Sb(),ne.Tb(20,"span",5),ne.Kc(21,"Page can create pop-up windows or create new tab in the browser."),ne.Sb(),ne.Tb(22,"span",6),ne.Kc(23,"*Note that created pages also follow the same sandbox options."),ne.Sb(),ne.Sb(),ne.Ob(24,"mat-divider"),ne.Tb(25,"h3",3),ne.Kc(26,"The additional options"),ne.Sb(),ne.Tb(27,"mat-list-item"),ne.Tb(28,"mat-checkbox",7),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-downloads"]=e})),ne.Kc(29,"Allow Downlading Files From Sandboxed Pages"),ne.Sb(),ne.Tb(30,"span",5),ne.Kc(31,"Page allows automatically downloading files. If this option checked, browser will still ask you the file downloading locations."),ne.Sb(),ne.Sb(),ne.Tb(32,"mat-list-item"),ne.Tb(33,"mat-checkbox",7),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-orientation-lock"]=e})),ne.Kc(34,"Allow Orientation Lock"),ne.Sb(),ne.Tb(35,"span",5),ne.Kc(36,"Page can lock the screen orientation."),ne.Sb(),ne.Sb(),ne.Tb(37,"mat-list-item"),ne.Tb(38,"mat-checkbox",7),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-pointer-lock"]=e})),ne.Kc(39,"Allow Pointer Lock"),ne.Sb(),ne.Tb(40,"span",5),ne.Kc(41,"Page can use the Pointer Lock API."),ne.Sb(),ne.Sb(),ne.Ob(42,"mat-divider"),ne.Tb(43,"h3",3),ne.Kc(44,"The risk options"),ne.Sb(),ne.Tb(45,"mat-list-item"),ne.Tb(46,"mat-checkbox",7),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-forms"]=e})),ne.Kc(47,"Allow Form Submission"),ne.Sb(),ne.Tb(48,"span",5),ne.Kc(49,"Page can submit form data."),ne.Sb(),ne.Sb(),ne.Tb(50,"mat-list-item"),ne.Tb(51,"mat-checkbox",4),ne.bc("ngModelChange",(function(e){return t.authorizedList["allow-same-origin"]=e})),ne.Kc(52,"Allow Same Origin"),ne.Sb(),ne.Tb(53,"span",5),ne.Kc(54,"Page can use cookie, indexedDB form data. Do NOT allow this unless you trust the content."),ne.Sb(),ne.Tb(55,"span",6),ne.Kc(56,"The "),ne.Tb(57,"b"),ne.Kc(58,"same-origin policy"),ne.Sb(),ne.Kc(59,"is a critical security mechanism that restricts how a document or script loaded from one origin can interact with a resource from another origin. It helps isolate potentially malicious documents, reducing possible attack vectors. "),ne.Sb(),ne.Sb(),ne.Sb(),ne.Sb(),ne.Tb(60,"div",8),ne.Tb(61,"button",9),ne.Kc(62,"Cancel"),ne.Sb(),ne.Tb(63,"button",10),ne.bc("click",(function(){return t.save()})),ne.Kc(64,"Ok"),ne.Sb(),ne.Sb()),2&e&&(ne.Ab(3),ne.mc("ngIf",!1),ne.Ab(5),ne.mc("ngModel",t.authorizedList["allow-scripts"])("disabled","proxyPages"===t.entryType),ne.Ab(5),ne.mc("ngModel",t.authorizedList["allow-modals"])("disabled","proxyPages"===t.entryType),ne.Ab(5),ne.mc("ngModel",t.authorizedList["allow-popups"])("disabled","proxyPages"===t.entryType),ne.Ab(10),ne.mc("ngModel",t.authorizedList["allow-downloads"]),ne.Ab(5),ne.mc("ngModel",t.authorizedList["allow-orientation-lock"]),ne.Ab(5),ne.mc("ngModel",t.authorizedList["allow-pointer-lock"]),ne.Ab(8),ne.mc("ngModel",t.authorizedList["allow-forms"]),ne.Ab(5),ne.mc("ngModel",t.authorizedList["allow-same-origin"])("disabled","proxyPages"===t.entryType))},directives:[g.h,g.e,i.n,y.a,y.e,y.c,f.a,he.h,s.i,s.l,b.a,g.c,c.b,g.d],encapsulation:2}),Pe),Se=r("zXF6");function Ie(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"button",6),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc().index;return ne.fc(2).uploadSettings[e].push([null])})),ne.Kc(1,"Add"),ne.Sb()}}function we(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"button",6),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc().index,t=ne.fc().index;return ne.fc(2).removeFileInput(t,e)})),ne.Kc(1,"Remove"),ne.Sb()}}function Ae(e,t){if(1&e&&(ne.Rb(0),ne.Tb(1,"div"),ne.Ob(2,"input",7),ne.Ic(3,we,2,0,"button",5),ne.Sb(),ne.Qb()),2&e){var r=t.index,n=ne.fc().index,a=ne.fc(2);ne.Ab(1),ne.Bb("id",a.eventID+"-"+n+"-"+r),ne.Ab(2),ne.mc("ngIf",0!==r)}}function Fe(e,t){if(1&e&&(ne.Rb(0),ne.Tb(1,"tr"),ne.Tb(2,"td"),ne.Kc(3),ne.Ob(4,"br"),ne.Ic(5,Ie,2,0,"button",5),ne.Sb(),ne.Tb(6,"td"),ne.Ic(7,Ae,4,2,"ng-container",4),ne.Sb(),ne.Ob(8,"td"),ne.Sb(),ne.Qb()),2&e){var r=t.$implicit,n=t.index,a=ne.fc(2);ne.Ab(3),ne.Mc(" ",r.displayInfo,""),ne.Ab(2),ne.mc("ngIf",r.multiple),ne.Ab(2),ne.mc("ngForOf",a.uploadSettings[n])}}function Ce(e,t){if(1&e&&(ne.Rb(0),ne.Tb(1,"table",3),ne.Tb(2,"thead"),ne.Tb(3,"tr"),ne.Tb(4,"th"),ne.Kc(5,"Description"),ne.Sb(),ne.Tb(6,"th"),ne.Kc(7,"Upload"),ne.Sb(),ne.Tb(8,"th"),ne.Kc(9,"Progress"),ne.Sb(),ne.Sb(),ne.Sb(),ne.Tb(10,"tbody"),ne.Ic(11,Fe,9,3,"ng-container",4),ne.Sb(),ne.Sb(),ne.Qb()),2&e){var r=ne.fc();ne.Ab(11),ne.mc("ngForOf",r.uploadSpec)}}var je,De=((je=function(){function e(t,r,n,a,i){_classCallCheck(this,e),this.el=t,this.dialogRef=r,this.uploader=n,this.infoService=a,this.data=i,this.pageInfo=i.page,this.currentProject=i.project,this.eventID=i.eventID,this.uploadSpec=i.uploadSettings}return _createClass(e,[{key:"ngOnInit",value:function(){this.uploadSpec=[{folder:"",keepFileName:!1,name:"just-a-test",desc:"Testing!!",tags:["file","just","for","testing"],displayInfo:"This is a single file field",multiple:!1},{folder:"",keepFileName:!1,name:"Testing-2",desc:"Testing!!",tags:["file","just","for","testing"],displayInfo:"This is a multiple-file field",multiple:!0}],this.eventID="testabcd",this.uploadSettings=this.uploadSpec.map((function(e){return[null]})),console.log(this.uploadElements)}},{key:"removeFileInput",value:function(e,t){$("#"+this.eventID+"-"+e+"-"+t).remove(),this.uploadSettings[e].splice(t,1)}},{key:"ngOnDestroy",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||je)(ne.Nb(ne.l),ne.Nb(g.g),ne.Nb(Se.a),ne.Nb(se.a),ne.Nb(g.a))},je.\u0275cmp=ne.Hb({type:je,selectors:[["uploader-ui"]],viewQuery:function(e,t){var r;1&e&&(ne.Qc(v.n,!0),ne.Qc(ne.l,!0)),2&e&&(ne.wc(r=ne.cc())&&(t.uploaderProgress=r.first),ne.wc(r=ne.cc())&&(t.uploadElements=r))},decls:10,vars:2,consts:[["mat-dialog-title",""],["mat-stroked-button","","mat-dialog-close",""],[4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],["name","fileInput","type","file"]],template:function(e,t){1&e&&(ne.Tb(0,"h3",0),ne.Kc(1,"File Uploader Helper"),ne.Sb(),ne.Tb(2,"mat-dialog-actions"),ne.Tb(3,"button",1),ne.Kc(4,"Close"),ne.Sb(),ne.Sb(),ne.Ob(5,"br"),ne.Ob(6,"br"),ne.Ob(7,"br"),ne.Kc(8),ne.Ic(9,Ce,12,1,"ng-container",2)),2&e&&(ne.Ab(8),ne.Mc("\nYou are uploading files for the page: ",t.pageInfo.name,".\n"),ne.Ab(1),ne.mc("ngIf",t.currentProject))},directives:[g.h,g.c,c.b,g.d,i.n,i.m],styles:[".my-drop-zone[_ngcontent-%COMP%]{font-size:1.25rem;background-color:#c8dadf;position:relative;padding:60px 20px;outline:2px dashed #92b0b3;outline-offset:-10px;transition:outline-offset .15s ease-in-out,background-color .15s linear}.nv-file-over[_ngcontent-%COMP%]{outline-offset:-20px;outline-color:#c8dadf;background-color:#fff}"]}),je),Re=r("jhN1"),Ke=["client"],Oe=["sandboxContainer"];function Me(e,t){if(1&e){var r=ne.Ub();ne.Rb(0),ne.Tb(1,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc().historyBack()})),ne.Ob(2,"i",10),ne.Sb(),ne.Tb(3,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc().historyForward()})),ne.Ob(4,"i",11),ne.Sb(),ne.Tb(5,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc().reloadClient()})),ne.Ob(6,"i",12),ne.Sb(),ne.Tb(7,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc().detectSizeChange()})),ne.Ob(8,"i",13),ne.Sb(),ne.Tb(9,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc().changeMode()})),ne.Ob(10,"i",14),ne.Sb(),ne.Tb(11,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc().authorizeSandbox()})),ne.Ob(12,"i",15),ne.Sb(),ne.Tb(13,"button",9),ne.bc("click",(function(){return ne.Ac(r),ne.fc()._toggleFullPage()})),ne.Ob(14,"i",16),ne.Sb(),ne.Qb()}if(2&e){var n=ne.fc();ne.Ab(14),ne.Eb("fa-expand-arrows-alt",!n.isFullPage)("fa-compress-arrows-alt",n.isFullPage)}}function $e(e,t){if(1&e&&(ne.Tb(0,"a",18),ne.Kc(1),ne.Ob(2,"i",19),ne.Sb()),2&e){var r=ne.fc(2);ne.mc("href",r.src,ne.Dc),ne.Ab(1),ne.Mc("",r.src.changingThisBreaksApplicationSecurity," ")}}function _e(e,t){if(1&e&&(ne.Rb(0),ne.Ic(1,$e,3,2,"a",17),ne.Qb()),2&e){var r=ne.fc();ne.Ab(1),ne.mc("ngIf",r.src)}}function ze(e,t){if(1&e&&(ne.Rb(0),ne.Kc(1),ne.Qb()),2&e){var r=ne.fc();ne.Ab(1),ne.Mc(" ",r.src?r.src.changingThisBreaksApplicationSecurity:"unknown"," ")}}function Ve(e,t){if(1&e&&(ne.Rb(0),ne.Ob(1,"ngx-json-viewer",30),ne.Ob(2,"mat-divider"),ne.Qb()),2&e){var r=ne.fc(2).$implicit;ne.Ab(1),ne.mc("json",r)("expanded",!1)}}function Le(e,t){if(1&e&&(ne.Rb(0),ne.Ic(1,Ve,3,2,"ng-container",0),ne.Qb()),2&e){var r=t.$implicit,n=ne.fc(4);ne.Ab(1),ne.mc("ngIf","log"===r.key&&n.logFilter[2]||"sent"===r.key&&n.logFilter[0]||"received"===r.key&&n.logFilter[1]||"event"===r.key&&n.logFilter[3]||"error"===r.key&&n.logFilter[4]||"change"===r.key&&n.logFilter[5])}}function Be(e,t){if(1&e&&(ne.Rb(0),ne.Ic(1,Le,2,1,"ng-container",29),ne.gc(2,"keyvalue"),ne.Qb()),2&e){var r=t.$implicit;ne.Ab(1),ne.mc("ngForOf",ne.hc(2,1,r))}}function Ne(e,t){if(1&e&&(ne.Tb(0,"div",28),ne.Ic(1,Be,3,3,"ng-container",29),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(1),ne.mc("ngForOf",r.sandboxAPI.logItems)}}function Ee(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"mat-expansion-panel",20,21),ne.Tb(2,"mat-expansion-panel-header",22),ne.Tb(3,"mat-panel-title"),ne.Tb(4,"span",23),ne.Kc(5,"Console Logs"),ne.Sb(),ne.Sb(),ne.Sb(),ne.Tb(6,"div",24),ne.Tb(7,"div"),ne.Tb(8,"mat-checkbox",25),ne.bc("ngModelChange",(function(e){return ne.Ac(r),ne.fc().logFilter[0]=e})),ne.Kc(9,"Sent"),ne.Sb(),ne.Tb(10,"mat-checkbox",25),ne.bc("ngModelChange",(function(e){return ne.Ac(r),ne.fc().logFilter[1]=e})),ne.Kc(11,"Received"),ne.Sb(),ne.Tb(12,"mat-checkbox",25),ne.bc("ngModelChange",(function(e){return ne.Ac(r),ne.fc().logFilter[2]=e})),ne.Kc(13,"Logged"),ne.Sb(),ne.Tb(14,"mat-checkbox",25),ne.bc("ngModelChange",(function(e){return ne.Ac(r),ne.fc().logFilter[3]=e})),ne.Kc(15,"Events"),ne.Sb(),ne.Tb(16,"mat-checkbox",25),ne.bc("ngModelChange",(function(e){return ne.Ac(r),ne.fc().logFilter[4]=e})),ne.Kc(17,"Errors"),ne.Sb(),ne.Tb(18,"mat-checkbox",25),ne.bc("ngModelChange",(function(e){return ne.Ac(r),ne.fc().logFilter[5]=e})),ne.Kc(19,"Changes"),ne.Sb(),ne.Sb(),ne.Tb(20,"button",26),ne.bc("click",(function(){return ne.Ac(r),ne.fc().sandboxAPI.logItems=[]})),ne.Kc(21,"Clear logs"),ne.Sb(),ne.Sb(),ne.Ic(22,Ne,2,1,"div",27),ne.Sb()}if(2&e){var n=ne.xc(1),a=ne.fc();ne.mc("hidden",a.isFullPage),ne.Ab(2),ne.mc("collapsedHeight","28px")("expandedHeight","28px"),ne.Ab(6),ne.mc("ngModel",a.logFilter[0]),ne.Ab(2),ne.mc("ngModel",a.logFilter[1]),ne.Ab(2),ne.mc("ngModel",a.logFilter[2]),ne.Ab(2),ne.mc("ngModel",a.logFilter[3]),ne.Ab(2),ne.mc("ngModel",a.logFilter[4]),ne.Ab(2),ne.mc("ngModel",a.logFilter[5]),ne.Ab(4),ne.mc("ngIf",n.expanded)}}function qe(e,t){1&e&&(ne.Tb(0,"div",34),ne.Tb(1,"h1",35),ne.Kc(2,"Processing ... "),ne.Ob(3,"i",36),ne.Sb(),ne.Sb())}function Ue(e,t){if(1&e&&ne.Ob(0,"img",54),2&e){var r=ne.fc(2).$implicit,n=ne.fc().$implicit,a=ne.fc(3);ne.mc("src",a.validPages.get(n.id+":"+r).thumbnail,ne.Dc)}}function Ge(e,t){1&e&&ne.Ob(0,"i",55)}function He(e,t){1&e&&(ne.Rb(0),ne.Kc(1,"Current Page"),ne.Qb())}function Qe(e,t){if(1&e&&ne.Ob(0,"img",56),2&e){var r=ne.fc(2).$implicit,n=ne.fc().$implicit,a=ne.fc(3);ne.Eb("mt-4",a.activePageKey!==n.id+":"+r),ne.mc("src",a.validPages.get(n.id+":"+r).img,ne.Dc)}}function Je(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"button",9),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc(2).$implicit,t=ne.fc().$implicit;return ne.fc(3).changePageKey(t.id+":"+e,t)})),ne.Kc(1,"Select"),ne.Sb()}}function We(e,t){if(1&e&&(ne.Tb(0,"div",49),ne.Tb(1,"mat-card"),ne.Tb(2,"mat-card-header"),ne.Ic(3,Ue,1,1,"img",50),ne.Ic(4,Ge,1,0,"i",51),ne.Tb(5,"mat-card-title"),ne.Kc(6),ne.Sb(),ne.Tb(7,"mat-card-subtitle"),ne.Ic(8,He,2,0,"ng-container",0),ne.Sb(),ne.Sb(),ne.Ic(9,Qe,1,3,"img",52),ne.Tb(10,"mat-card-content"),ne.Tb(11,"p"),ne.Kc(12),ne.gc(13,"slice"),ne.Sb(),ne.Sb(),ne.Tb(14,"mat-card-actions"),ne.Ic(15,Je,2,0,"button",53),ne.Sb(),ne.Sb(),ne.Sb()),2&e){var r=ne.fc().$implicit,n=ne.fc().$implicit,a=ne.fc(3);ne.Ab(1),ne.Hc("background-color",a.activePageKey===n.id+":"+r?"rgba(255, 255, 0, 0.3)":"transparent"),ne.Ab(2),ne.mc("ngIf",a.validPages.get(n.id+":"+r).thumbnail),ne.Ab(1),ne.mc("ngIf",!a.validPages.get(n.id+":"+r).thumbnail),ne.Ab(2),ne.Lc(a.validPages.get(n.id+":"+r).name),ne.Ab(2),ne.mc("ngIf",a.activePageKey===n.id+":"+r),ne.Ab(1),ne.mc("ngIf",a.validPages.get(n.id+":"+r).img),ne.Ab(3),ne.Lc(ne.jc(13,9,a.validPages.get(n.id+":"+r).desc,0,60)),ne.Ab(3),ne.mc("ngIf",a.activePageKey!==n.id+":"+r)}}function Xe(e,t){if(1&e&&(ne.Rb(0),ne.Ic(1,We,16,13,"div",48),ne.Qb()),2&e){var r=t.$implicit;ne.Ab(1),ne.mc("ngIf",r)}}function Ye(e,t){if(1&e&&(ne.Tb(0,"div",43),ne.Tb(1,"h3",44),ne.Ob(2,"i",45),ne.Kc(3),ne.Ob(4,"i",46),ne.Kc(5),ne.Sb(),ne.Ic(6,Xe,2,1,"ng-container",29),ne.Ob(7,"mat-divider",47),ne.Sb()),2&e){var r=t.$implicit,n=ne.fc(3);ne.Ab(3),ne.Mc(" ",r.fullname," from "),ne.Ab(2),ne.Mc(" ",r.sheetName,""),ne.Ab(1),ne.mc("ngForOf",n.keyOrders[r.id])}}function Ze(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"div",37),ne.Tb(1,"div",38),ne.Tb(2,"button",39),ne.bc("click",(function(){return ne.Ac(r),ne.fc(2).changeMode()})),ne.Ob(3,"i",40),ne.Sb(),ne.Tb(4,"h1"),ne.Kc(5,"Page entries"),ne.Sb(),ne.Sb(),ne.Ob(6,"mat-divider"),ne.Tb(7,"div",41),ne.Ic(8,Ye,8,3,"div",42),ne.Sb(),ne.Sb()}if(2&e){var n=ne.fc(2);ne.Ab(8),ne.mc("ngForOf",n.currentPackages)}}function et(e,t){if(1&e&&(ne.Tb(0,"div",31),ne.Ic(1,qe,4,0,"div",32),ne.Ic(2,Ze,9,1,"div",33),ne.Sb()),2&e){var r=ne.fc();ne.Ab(1),ne.mc("ngIf",r.frameProcessing&&"list"!==r.mode),ne.Ab(1),ne.mc("ngIf","list"===r.mode)}}var tt,rt=((tt=function(){function e(t,r,n,a){_classCallCheck(this,e),this.sanitizer=t,this.dialog=r,this.systemService=n,this.sandboxAPI=a,this.pageChange=new ne.o,this.requestNavigation=new ne.o,this.requestFullPage=new ne.o,this.rightSideMenuStateChange=new ne.o,this.modeChage=new ne.o,this._subs=[],this.subscribers={},this.src=this.sanitizer.bypassSecurityTrustResourceUrl("/assets/pages/not-found.html"),this.logItems=[],this.frameProcessing=!1,this.logFilter=[!0,!0,!0,!1,!0,!1],this.validPages=new Map,this.activePageKey=null,this.sandboxAuthorizedSet=new Set(["allow-scripts","allow-modals","allow-popups"])}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.detectSizeChange(),this.sandboxAPI.client$.next(this.client),this.systemService.toggleContentScrollbar(!1),this._subs.push(this.sandboxAPI.isFullPage$.subscribe((function(t){return e.requestFullPage.emit(t)}))),this._subs.push(this.sandboxAPI.showRightMenu$.subscribe((function(t){return e.rightSideMenuStateChange.emit(t)}))),this._subs.push(this.sandboxAPI.pageMode$.subscribe((function(t){return e.modeChage.emit(t)}))),this._subs.push(this.sandboxAPI.requestNavigation$.subscribe((function(t){return e.requestNavigation.emit(t)}))),this._subs.push(this.sandboxAPI.refresh$.subscribe((function(){return e.reloadClient()})))}},{key:"ngOnChanges",value:function(e){var t=this,r=!1;for(var n in e)"currentProject"===n?(this.currentProject=e[n].currentValue,this.sandboxAPI.currentProject$.next(this.currentProject),this.currentPackages=this.currentProject.packages,this.sandboxAPI.currentPackages$.next(this.currentPackages),e[n].currentValue&&e[n].previousValue&&e[n].currentValue.id!==e[n].previousValue.id&&(r=!0)):"currentResult"===n?(this.currentResult=e[n].currentValue,this.sandboxAPI.currentResult$.next(this.currentResult),e[n].currentValue&&e[n].previousValue&&e[n].currentValue.id!==e[n].previousValue.id&&(r=!0)):"currentDataFile"===n?(this.currentDataFile=e[n].currentValue,this.sandboxAPI.currentDataFile$.next(this.currentDataFile),e[n].currentValue&&e[n].previousValue&&e[n].currentValue.id!==e[n].previousValue.id&&(r=!0)):"pageKey"===n?(this.activePageKey=e[n].currentValue,this.sandboxAPI.currentPageKey$.next(this.activePageKey),e[n].currentValue!==e[n].previousValue&&(r=!0)):"validPages"===n?this.validPages=e[n].currentValue:"entryType"===n?(this.entryType=e[n].currentValue,this.sandboxAPI.entryType$.next(this.entryType),e[n].currentValue!==e[n].previousValue&&(r=!0)):"currentPackages"===n?(this.currentPackages=e[n].currentValue,this.sandboxAPI.currentPackages$.next(this.currentPackages)):"isFullPage"===n?this.sandboxAPI.isFullPage$.next(e[n].currentValue):"mode"===n?(this.mode="list"===e[n].currentValue?"list":"page",this.sandboxAPI.pageMode$.next(this.mode)):"currentUser"===n&&(this.currentUser=e[n].currentValue,this.sandboxAPI.currentUser$.next(this.currentUser));var a=this.src||{};if("staticPages"===this.entryType||"proxyPages"===this.entryType||this.validPages.has(this.activePageKey)){var i;if("staticPages"===this.entryType)i=this.sanitizer.bypassSecurityTrustResourceUrl("/data/api/dataFile/"+this.currentDataFile.id+"/static"),this.sandboxAuthorizedSet.add("allow-downloads");else if("proxyPages"===this.entryType)i=this.sanitizer.bypassSecurityTrustResourceUrl("/result/"+this.currentResult.id+"/requestProxy"),this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms");else{var s=this.activePageKey.split(":")[0];i=this.securePagePath(this.validPages.get(this.activePageKey).path,s)}i&&a.changingThisBreaksApplicationSecurity!==i.changingThisBreaksApplicationSecurity?(console.log("".concat(a.changingThisBreaksApplicationSecurity," changed to ").concat(i.changingThisBreaksApplicationSecurity)),setTimeout((function(){return t.src=i})),this.logItems=[]):r&&(this.src=this.securePagePath("/assets/pages/prepare.html"),"proxyPages"===this.entryType&&(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")),setTimeout((function(){t.src=i,t.currentIndexedDB=void 0}))),setTimeout((function(){return t.detectSizeChange()}),500)}else r&&(console.log("forceupdate change src2"),"proxyPages"===this.entryType?(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")):(this.sandboxAuthorizedSet.delete("allow-same-origin"),this.sandboxAuthorizedSet.delete("allow-forms")),"staticPages"===this.entryType?this.sandboxAuthorizedSet.add("allow-downloads"):this.sandboxAuthorizedSet.delete("allow-downloads"),setTimeout((function(){t.src=t.securePagePath("/assets/pages/not-found.html"),t.currentIndexedDB=void 0})))}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout((function(){return e.detectSizeChange()}),1e3)}},{key:"onResize",value:function(){var e=this;clearTimeout(this.onResizeTimer),this.onResizeTimer=setTimeout((function(){return e.detectSizeChange()}),500)}},{key:"reloadClient",value:function(e){var t=this,r=e||this.src;"proxyPages"===this.entryType&&(this.sandboxAuthorizedSet.add("allow-same-origin"),this.sandboxAuthorizedSet.add("allow-forms")),this.src=this.securePagePath("/assets/pages/prepare.html"),setTimeout((function(){console.log("content reloaded"),t.src=r,t.currentIndexedDB=void 0,t.onResize()}),300)}},{key:"changeMode",value:function(e){var t=this.sandboxAPI.pageMode$.getValue();this.sandboxAPI.pageMode$.next("list"==(e=e||"list"!==t?"list":"page")?"list":"page")}},{key:"historyBack",value:function(){this.sandboxAPI.historyBack()}},{key:"historyForward",value:function(){this.sandboxAPI.historyForward()}},{key:"detectSizeChange",value:function(){if(this.client){this.frameWidth=$(this.sandboxContainer.nativeElement).innerWidth();var e=window.innerHeight,t=this.sandboxAPI.isFullPage$.getValue()?e-30:e-274;this.frameHeight=t}}},{key:"onSrcChanged",value:function(e){}},{key:"securePagePath",value:function(e,t){return e=e.replace(/^http[s]:/g,"").replace(/\.\./g,""),t&&(e=0===e.indexOf("/")?"/page/api/".concat(t).concat(e):"/page/api/".concat(t,"/").concat(e)),this.sanitizer.bypassSecurityTrustResourceUrl(e)}},{key:"changePageKey",value:function(e,t){console.log(e,this.activePageKey),e!==this.activePageKey&&this.pageChange.emit({page:this.validPages.get(e),package:t}),this.mode="page"}},{key:"_toggleFullPage",value:function(){this.sandboxAPI._toggleFullPage()}},{key:"openUploaderUI",value:function(){this.dialog.open(De,{minWidth:"90vw",minHeight:"90vh",disableClose:!0,data:{project:this.currentProject,page:this.validPages[this.activePageKey]}})}},{key:"notifyDataChange",value:function(e){this.sandboxAPI.sendToClient({type:"change",value:e})}},{key:"onMessagereceived",value:function(e){if(e.data.call&&e.data.id){this.sandboxAPI.logItems.push({sent:e.data});var t=e.data.id,r=e.data.call,n=e.data.value;this.sandboxAPI.isValidAPI(r)?this.sandboxAPI[r](t,n):this.sandboxAPI.sendToClient({id:t,call:r,type:"error",value:"The call ".concat(r," is not part of the API.")})}}},{key:"authorizeSandbox",value:function(){var e=this,t=this.dialog.open(xe,{data:{authorizedList:this.sandboxAuthorized,entryType:this.entryType}}).afterClosed().subscribe((function(r){t.unsubscribe(),Array.isArray(r)&&(0===r.length?e.sandboxAuthorizedSet.add("allow-modal"):e.sandboxAuthorizedSet=new Set(r),e.reloadClient())}))}},{key:"ngOnDestroy",value:function(){this.systemService.toggleContentScrollbar(!0),clearTimeout(this.timeout),clearTimeout(this.onResizeTimer),this._subs.forEach((function(e){return e.unsubscribe()})),console.log("Sandbox destroyed")}},{key:"sandboxAuthorized",get:function(){return _toConsumableArray(this.sandboxAuthorizedSet)}}]),e}()).\u0275fac=function(e){return new(e||tt)(ne.Nb(Re.b),ne.Nb(g.b),ne.Nb(ue.a),ne.Nb(de))},tt.\u0275cmp=ne.Hb({type:tt,selectors:[["bdp-sandbox"]],viewQuery:function(e,t){var r;1&e&&(ne.Gc(Ke,!0),ne.Gc(Oe,!0)),2&e&&(ne.wc(r=ne.cc())&&(t.client=r.first),ne.wc(r=ne.cc())&&(t.sandboxContainer=r.first))},inputs:{currentProject:"currentProject",currentResult:"currentResult",currentDataFile:"currentDataFile",currentUser:"currentUser",currentPackages:"currentPackages",entryType:"entryType",keyOrders:"keyOrders",origin:"origin",pageKey:"pageKey",validPages:"validPages",mode:"mode",isFullPage:"isFullPage"},outputs:{pageChange:"pageChange",requestNavigation:"requestNavigation",requestFullPage:"requestFullPage",rightSideMenuStateChange:"rightSideMenuStateChange",modeChage:"modeChage"},features:[ne.yb],decls:12,vars:12,consts:[[4,"ngIf"],[1,"px-3",2,"background-color","lightgray","width","100%",3,"hidden"],[1,"fas","fa-greater-than","mx-2"],[3,"hidden",4,"ngIf"],[2,"position","relative","overflow","auto","padding","0px",3,"resize"],["sandboxContainer",""],["frameborder","0",2,"position","relative",3,"width","height","src","message","load"],["client",""],["style","position: absolute; background-color: rgba(255, 255, 255, 0.9); top: 0px; left: 0px; right: 0px; bottom: 0px;",4,"ngIf"],["mat-stroked-button","",3,"click"],[1,"fas","fa-arrow-left"],[1,"fas","fa-arrow-right"],[1,"fas","fa-sync-alt"],[1,"fas","fa-expand"],[1,"fas","fa-th-large"],[1,"fas","fa-unlock"],[1,"fas"],["target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"],[1,"fas","fa-external-link-alt","ml-1"],[3,"hidden"],["expander",""],[2,"background-color","#F0F0F0",3,"collapsedHeight","expandedHeight"],[2,"color","#2d2d2d"],[1,"d-flex","justify-content-between","align-items-center"],[3,"ngModel","ngModelChange"],["mat-button","","color","warn",3,"click"],["style","max-height: 250px; overflow: auto;",4,"ngIf"],[2,"max-height","250px","overflow","auto"],[4,"ngFor","ngForOf"],[2,"font-size","12px","padding","0px",3,"json","expanded"],[2,"position","absolute","background-color","rgba(255, 255, 255, 0.9)","top","0px","left","0px","right","0px","bottom","0px"],["style","position: absolute; top: 30px; left: 50%; transform: translateX(-50%) translateY(-30%);",4,"ngIf"],["class","p-3",4,"ngIf"],[2,"position","absolute","top","30px","left","50%","transform","translateX(-50%) translateY(-30%)"],[1,"display-4","text-center"],[1,"fas","fa-circle-notch","fa-spin"],[1,"p-3"],[1,"d-flex","flex-row"],["mat-stroked-button","",1,"mr-2",3,"click"],[1,"fas","fa-times","fa-fw"],[1,"container-fluid"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12","text-muted"],[1,"fas","fa-cube","fa-lg","mr-2"],[1,"fas","fa-cubes","fa-lg","mr-2"],[1,"col-12","my-2"],["class","col-md-6 col-lg-4 col-xl-3 p-2",4,"ngIf"],[1,"col-md-6","col-lg-4","col-xl-3","p-2"],["mat-card-avatar","",3,"src",4,"ngIf"],["class","fas fa-scroll fa-fw fa-2x","mat-card-avatar","",4,"ngIf"],["mat-card-image","",3,"mt-4","src",4,"ngIf"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-card-avatar","",3,"src"],["mat-card-avatar","",1,"fas","fa-scroll","fa-fw","fa-2x"],["mat-card-image","",3,"src"]],template:function(e,t){1&e&&(ne.Ic(0,Me,15,4,"ng-container",0),ne.Tb(1,"div",1),ne.Tb(2,"small"),ne.Ob(3,"i",2),ne.Ic(4,_e,2,1,"ng-container",0),ne.Ic(5,ze,2,1,"ng-container",0),ne.Sb(),ne.Sb(),ne.Ic(6,Ee,23,10,"mat-expansion-panel",3),ne.Tb(7,"div",4,5),ne.bc("resize",(function(){return t.onResize()}),!1,ne.zc),ne.Tb(9,"iframe",6,7),ne.bc("message",(function(e){return t.onMessagereceived(e)}),!1,ne.zc)("load",(function(e){return t.onSrcChanged(e)})),ne.Sb(),ne.Ic(11,et,3,2,"div",8),ne.Sb()),2&e&&(ne.mc("ngIf",!t.isFullPage),ne.Ab(1),ne.mc("hidden",t.isFullPage),ne.Ab(3),ne.mc("ngIf","staticPages"===t.entryType||"proxyPages"===t.entryType),ne.Ab(1),ne.mc("ngIf","staticPages"!==t.entryType&&"proxyPages"!==t.entryType),ne.Ab(1),ne.mc("ngIf","staticPages"!==t.entryType&&"proxyPages"!==t.entryType),ne.Ab(1),ne.Hc("border",t.isFullPage?"":"thin solid black"),ne.Ab(2),ne.mc("width",t.frameWidth)("height",t.frameHeight)("src",t.src,ne.Cc),ne.Bb("sandbox",t.sandboxAuthorized.join(" ")),ne.Ab(2),ne.mc("ngIf",t.frameProcessing||"list"===t.mode))},directives:[i.n,c.b,o.c,o.f,o.g,f.a,s.i,s.l,i.m,k.a,b.a,d.a,d.f,d.j,d.i,d.d,d.b,d.c,d.g],pipes:[i.h,i.v],styles:[".mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0 0 0 16px}.mat-checkbox[_ngcontent-%COMP%]{padding-right:14px}"]}),tt),nt=["sandbox"],at=function(e){return["/project",e,"info"]};function it(e,t){if(1&e&&(ne.Tb(0,"a",6),ne.Kc(1),ne.Sb()),2&e){var r=ne.fc(2);ne.mc("routerLink",ne.qc(2,at,r.currentProject.id)),ne.Ab(1),ne.Mc("Project: ",r.currentProject.name,"")}}function st(e,t){if(1&e&&(ne.Tb(0,"span"),ne.Kc(1),ne.Sb()),2&e){var r=ne.fc(3);ne.Ab(1),ne.Lc(r.currentPage.name)}}function ct(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Kc(1,"Project Page: "),ne.Ic(2,st,2,1,"span",10),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(2),ne.mc("ngIf",r.currentPage)}}var ot=function(e){return["/result",e,"info"]};function ut(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Kc(1,"Result: "),ne.Tb(2,"a",6),ne.Tb(3,"u",11),ne.Kc(4),ne.Sb(),ne.Kc(5),ne.Tb(6,"u",11),ne.Kc(7),ne.Sb(),ne.Sb(),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(2),ne.mc("routerLink",ne.qc(4,ot,r.currentResult.id)),ne.Ab(2),ne.Lc(r.currentResult.prefix),ne.Ab(1),ne.Lc(r.currentResult.name||"(no-name)"),ne.Ab(2),ne.Lc(r.currentResult.suffix)}}function lt(e,t){if(1&e&&(ne.Tb(0,"span"),ne.Kc(1),ne.Sb()),2&e){var r=ne.fc(3);ne.Ab(1),ne.Lc(r.currentPage.name)}}function dt(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Kc(1,"Result Page: "),ne.Ic(2,lt,2,1,"span",10),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(2),ne.mc("ngIf",r.currentPage)}}var ft=function(e){return["/result",e,"requestProxy"]};function gt(e,t){if(1&e&&(ne.Tb(0,"span"),ne.Tb(1,"a",12),ne.Kc(2," Proxy "),ne.Ob(3,"i",13),ne.Sb(),ne.Sb()),2&e){var r=ne.fc(3);ne.Ab(1),ne.mc("routerLink",ne.qc(1,ft,r.currentResult.id))}}function bt(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Ic(1,gt,4,3,"span",10),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(1),ne.mc("ngIf",r.currentResult)}}var ht=function(e){return["/dataFile",e,"info"]};function pt(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Kc(1,"Data File: "),ne.Tb(2,"a",6),ne.Tb(3,"u",11),ne.Kc(4),ne.Sb(),ne.Kc(5),ne.Tb(6,"u",11),ne.Kc(7),ne.Sb(),ne.Sb(),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(2),ne.mc("routerLink",ne.qc(4,ht,r.currentDataFile.id)),ne.Ab(2),ne.Lc(r.currentDataFile.prefix),ne.Ab(1),ne.Lc(r.currentDataFile.name||"(no-name)"),ne.Ab(2),ne.Lc(r.currentDataFile.suffix)}}var vt=function(e){return["/data","api","dataFile",e,"static"]};function yt(e,t){if(1&e&&(ne.Tb(0,"span"),ne.Tb(1,"a",12),ne.Kc(2," Folder content "),ne.Ob(3,"i",13),ne.Sb(),ne.Sb()),2&e){var r=ne.fc(3);ne.Ab(1),ne.mc("routerLink",ne.qc(1,vt,r.currentDataFile.id))}}function mt(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Ic(1,yt,4,3,"span",10),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(1),ne.mc("ngIf",r.currentDataFile)}}function kt(e,t){if(1&e&&(ne.Tb(0,"span"),ne.Kc(1),ne.Sb()),2&e){var r=ne.fc(3);ne.Ab(1),ne.Lc(r.currentPage.name)}}function Tt(e,t){if(1&e&&(ne.Tb(0,"li",9),ne.Kc(1,"File Page: "),ne.Ic(2,kt,2,1,"span",10),ne.Sb()),2&e){var r=ne.fc(2);ne.Ab(2),ne.mc("ngIf",r.currentPage)}}var Pt=function(){return["/home"]},xt=function(){return["/project/list"]};function St(e,t){if(1&e&&(ne.Tb(0,"ol",4),ne.Tb(1,"li",5),ne.Tb(2,"a",6),ne.Kc(3,"Home"),ne.Sb(),ne.Sb(),ne.Tb(4,"li",5),ne.Tb(5,"a",6),ne.Kc(6,"Project List"),ne.Sb(),ne.Sb(),ne.Tb(7,"li",5),ne.Ic(8,it,2,4,"a",7),ne.Sb(),ne.Ic(9,ct,3,1,"li",8),ne.Ic(10,ut,8,6,"li",8),ne.Ic(11,dt,3,1,"li",8),ne.Ic(12,bt,2,1,"li",8),ne.Ic(13,pt,8,6,"li",8),ne.Ic(14,mt,2,1,"li",8),ne.Ic(15,Tt,3,1,"li",8),ne.Sb()),2&e){var r=ne.fc();ne.Ab(2),ne.mc("routerLink",ne.pc(10,Pt)),ne.Ab(3),ne.mc("routerLink",ne.pc(11,xt)),ne.Ab(3),ne.mc("ngIf",r.currentProject),ne.Ab(1),ne.mc("ngIf","indexPages"===r.entryType),ne.Ab(1),ne.mc("ngIf",r.currentResult),ne.Ab(1),ne.mc("ngIf","resultPages"===r.entryType),ne.Ab(1),ne.mc("ngIf","proxyPages"===r.entryType),ne.Ab(1),ne.mc("ngIf",r.currentDataFile),ne.Ab(1),ne.mc("ngIf","staticPages"===r.entryType),ne.Ab(1),ne.mc("ngIf","filePages"===r.entryType)}}function It(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"bdp-sandbox",14,15),ne.bc("pageChange",(function(e){return ne.Ac(r),ne.fc().onPageChange(e)}))("requestNavigation",(function(e){return ne.Ac(r),ne.fc().navigatePage(e)}))("requestFullPage",(function(e){return ne.Ac(r),ne.fc().toggleFullPage(e)}))("rightSideMenuStateChange",(function(e){return ne.Ac(r),ne.fc().toggleRightSideMenu(e)}))("modeChage",(function(e){return ne.Ac(r),ne.fc().onModeChange(e)})),ne.Sb()}if(2&e){var n=ne.fc();ne.mc("currentProject",n.currentProject)("currentResult",n.currentResult)("currentDataFile",n.currentDataFile)("currentPackages",n.currentPackages)("currentUser",n.currentUser)("isFullPage",n.isFullPage)("keyOrders",n.pageKeyOrders)("validPages",n.validPages)("pageKey",n.currentPageKey)("entryType",n.entryType)("mode",n.mode)}}function wt(e,t){1&e&&ne.Ob(0,"i",29)}function At(e,t){1&e&&ne.Ob(0,"i",30)}function Ft(e,t){1&e&&(ne.Rb(0),ne.Kc(1,"Full page"),ne.Qb())}function Ct(e,t){1&e&&(ne.Rb(0),ne.Kc(1,"Compress"),ne.Qb())}function jt(e,t){if(1&e){var r=ne.Ub();ne.Tb(0,"div",16),ne.Tb(1,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.showRightButtonContent=!e.showRightButtonContent})),ne.Ic(2,wt,1,0,"i",18),ne.Ic(3,At,1,0,"i",19),ne.Tb(4,"span",20),ne.Kc(5,"MENU"),ne.Sb(),ne.Tb(6,"span",21),ne.Kc(7,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(8,"br"),ne.Tb(9,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.sandbox&&e.sandbox.historyBack()})),ne.Ob(10,"i",22),ne.Tb(11,"span",23),ne.Kc(12,"Back"),ne.Sb(),ne.Tb(13,"span",21),ne.Kc(14,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(15,"br"),ne.Tb(16,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.sandbox&&e.sandbox.historyForward()})),ne.Ob(17,"i",24),ne.Tb(18,"span",23),ne.Kc(19,"Forward"),ne.Sb(),ne.Tb(20,"span",21),ne.Kc(21,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(22,"br"),ne.Tb(23,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.sandbox&&e.sandbox.detectSizeChange()})),ne.Ob(24,"i",25),ne.Tb(25,"span",23),ne.Kc(26,"Adjust size"),ne.Sb(),ne.Tb(27,"span",21),ne.Kc(28,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(29,"br"),ne.Tb(30,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.sandbox&&e.sandbox.reloadClient()})),ne.Ob(31,"i",26),ne.Tb(32,"span",23),ne.Kc(33,"Refresh"),ne.Sb(),ne.Tb(34,"span",21),ne.Kc(35,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(36,"br"),ne.Tb(37,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.mode="list"===e.mode?"page":"list"})),ne.Ob(38,"i",27),ne.Tb(39,"span",23),ne.Kc(40,"Page list"),ne.Sb(),ne.Tb(41,"span",21),ne.Kc(42,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(43,"br"),ne.Tb(44,"a",17),ne.bc("click",(function(){ne.Ac(r);var e=ne.fc();return e.toggleFullPage(!e.isFullPage)})),ne.Ob(45,"i",28),ne.Tb(46,"span",23),ne.Ic(47,Ft,2,0,"ng-container",10),ne.Ic(48,Ct,2,0,"ng-container",10),ne.Sb(),ne.Tb(49,"span",21),ne.Kc(50,"\u276f"),ne.Sb(),ne.Sb(),ne.Ob(51,"br"),ne.Sb()}if(2&e){var n=ne.fc();ne.mc("@rightButtonState",n.showRightButtonContent?"active":"inactive"),ne.Ab(2),ne.mc("ngIf",n.showRightButtonContent),ne.Ab(1),ne.mc("ngIf",!n.showRightButtonContent),ne.Ab(1),ne.Eb("active",n.showRightButtonContent),ne.Ab(7),ne.Eb("active",n.showRightButtonContent),ne.Ab(7),ne.Eb("active",n.showRightButtonContent),ne.Ab(7),ne.Eb("active",n.showRightButtonContent),ne.Ab(7),ne.Eb("active",n.showRightButtonContent),ne.Ab(5),ne.Eb("active","list"===n.mode),ne.Ab(2),ne.Eb("active",n.showRightButtonContent),ne.Ab(6),ne.Eb("fa-expand-alt",!n.isFullPage)("fa-compress-alt",n.isFullPage),ne.Ab(1),ne.Eb("active",n.showRightButtonContent),ne.Ab(1),ne.mc("ngIf",!n.isFullPage),ne.Ab(1),ne.mc("ngIf",n.isFullPage)}}var Dt,Rt,Kt=((Dt=function(){function e(t,r,n,a,i,s,c){_classCallCheck(this,e),this.route=t,this.router=r,this.systemService=n,this.infoService=a,this.projectService=i,this.taskService=s,this.accountService=c,this._subs=[]}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.systemService.maintainRightSidebarStatus(!0),this.currentPageKey=null,this.currentPage=null,this.currentPackages=null,this.displayRightSideMenu=!0,this.isFullPage=!1,this.entryType=null,this.mode="page",this._subs.push(this.accountService.currentUser$.subscribe((function(t){return e.currentUser=t}))),this._subs.push(this.systemService.sidebarStatus$.subscribe((function(t){e.sandbox&&e.sandbox.detectSizeChange&&(clearTimeout(e.onChildrenResizeTimer),e.onChildrenResizeTimer=setTimeout((function(){e.sandbox.detectSizeChange()}),500))}))),this._subs.push(this.infoService.incomingDataChange$.subscribe((function(t){var r=t.type,n=t.target,a=t.data;if("DataFile"===n||"Result"===n){if(a.project!==e.currentProject.id)return;var i;"DataFile"===n?i=new x.a(a):"Result"===n&&(i=new P.a(a)),e.sandbox.notifyDataChange({type:r,target:n,data:i.getModel()})}}))),this._subs.push(this.infoService.incomingResultOutput$.subscribe((function(t){var r=t.target.split(":");r[0]===e.currentProject.id&&e.sandbox.notifyDataChange({type:t.type,target:"ResultMsg",data:{resultId:r[1],content:t.data}})}))),this._subs.push(this.projectService.currentProject$.subscribe((function(t){e.currentProject=t,t&&(e.pages=t&&Array.isArray(t.packages)&&t.packages[0]?t.packages[0].pages:new be.a({}),"indexPages"===e.entryType&&e.getValidPages())}))),this._subs.push(this.projectService.currentResult$.subscribe((function(t){e.thisResultID&&t&&t.id===e.thisResultID?(e.currentProject&&"resultPages"===e.entryType||"proxyPages"===e.entryType)&&(e.currentResult=t,e.getValidPages()):void 0===t&&(e.currentResult=t)}))),this._subs.push(this.projectService.currentDataFile$.subscribe((function(t){e.thisDataFileID&&t&&t.id===e.thisDataFileID?!e.currentProject||"filePages"!==e.entryType&&"staticPages"!==e.entryType||(e.currentDataFile=t,e.getValidPages()):void 0===t&&(e.currentDataFile=t)}))),this.route.queryParamMap.subscribe((function(t){var r=t.get("project"),n=t.get("result"),a=t.get("datafile"),i=t.get("static"),s=t.get("proxy");if(e.currentPageKey=t.get("pageKey")||null,e.isFullPage="true"===t.get("fullpage"),r)e.entryType="indexPages",e.projectService.clearCurrentDataFile(),e.projectService.clearCurrentResult(),e.projectService.clearCurrentProject(),e.projectService.setCurrentProject(r,!1);else if(n){"true"===s?e.entryType="proxyPages":(e.entryType="resultPages",e.projectService.clearCurrentDataFile()),e.thisResultID=n;var c=e.projectService.loadResultInfo(n).subscribe((function(){return c.unsubscribe()}))}else if(a){e.thisDataFileID=a,"true"===i?e.entryType="staticPages":(e.entryType="filePages",e.projectService.clearCurrentResult());var o=e.projectService.loadDataFileInfo(a).subscribe((function(e){o.unsubscribe()}))}e.systemService.maintainRightSidebarStatus(!0)}))}},{key:"onResize",value:function(e){var t=this;clearTimeout(this.onResizeTimer),this.onResizeTimer=setTimeout((function(){return t.detectSizeChange()}),400)}},{key:"detectSizeChange",value:function(){var e=window.innerWidth<1024;this.isFullPage?this.systemService.toggleSidebar(!1,!0):this.systemService.toggleSidebar(!e)}},{key:"getValidPages",value:function(){var e=this,t=new Map;if(this.currentProject&&Array.isArray(this.currentProject.packages)&&this.currentProject.packages[0]&&this.currentProject.packages[0].pages){this.pageKeyOrders={};var r={},n=this.projectService.getRelatedPackages().subscribe((function(a){if(n.unsubscribe(),a.isError)return e.validPages=new Map,void(e.canInitialize=!0);var i=a.success;if(e.currentPackages=i,Array.isArray(i))for(var s=0;s<i.length;s++){var c=i[s];r[c.id]=[],e.pageKeyOrders[c.id]=[];var o=c.pages?c.pages[e.entryType]:[];Array.isArray(o)&&r[c.id].push.apply(r[c.id],o.filter((function(t){var r=!0;switch(e.entryType){case"resultPages":if(0===t.tasks.length)return!0;if(!e.currentResult)return!1;if(t.tasks.indexOf((e.currentResult.task&&e.currentResult.task.key?e.currentResult.task:e.currentResult.taskSnapshot).key)>=0)return!0;r=!1;break;case"filePages":var n=e.currentDataFile;if(!n)return!1;if(0===t.tags.length){if(!t.format)return!0;if(t.format===n.format)return!0}else{var a=t.rule;if("or"===a)return t.tags.filter((function(e){return n.tags.indexOf(e)>=0})).length>0;if("and"===a)return t.tags.filter((function(e){return n.tags.indexOf(e)>=0})).length===t.tags.length;if("all"===a)return t.tags.filter((function(e){return n.tags.indexOf(e)>=0})).length===n.tags.length}r=!1}return r})));for(var u=0;u<r[c.id].length;u++){var l=r[c.id][u];if(l.key){var d=c.id+":"+l.key;null==e.currentPageKey?(e.currentPageKey=d||null,e.currentPage=l):e.currentPageKey===d&&(e.currentPage=l),t.set(d,l),e.pageKeyOrders[c.id].push(l.key)}}}e.validPages=t,e.requestFullPage(e.isFullPage),setTimeout((function(){return e.canInitialize=!0}))}))}else this.router.navigate(this.currentProject?["/project",this.currentProject.id,"info"]:["/project/list"])}},{key:"onModeChange",value:function(e){this.mode="list"===e?"list":"page"}},{key:"onPageChange",value:function(e){this.canInitialize=!1;var t={project:void 0,result:void 0,datafile:void 0,pageKey:e.package.id+":"+e.page.key,fullpage:this.isFullPage?"true":"false",static:void 0,proxy:void 0};"indexPages"===this.entryType?t.project=this.currentProject.id:"resultPages"===this.entryType?(t.result=this.currentResult.id,t.proxy=!1):"filePages"===this.entryType?t.datafile=this.currentDataFile.id:"staticPages"===this.entryType?(t.datafile=this.currentDataFile.id,t.static=!0):"proxyPages"===this.entryType&&(t.result=this.currentResult.id,t.proxy=!0),this.currentPageKey=e.package.id+":"+e.page.key,this.mode="page",this.router.navigate(["/page"],{queryParams:t})}},{key:"navigatePage",value:function(e){var t=this;if(e){var r={pageKey:e.pageKey,fullpage:this.isFullPage?"true":"false"};r[e.type]=e.itemID,this.canInitialize=!1,this.router.navigate(["/page"],{queryParams:r}),e.pageKey===this.currentPageKey&&(r.datafile===this.thisDataFileID&&"filePages"===this.entryType||r.result===this.thisResultID&&"resultPages"===this.entryType||r.project&&"indexPages"===this.entryType)&&setTimeout((function(){return t.canInitialize=!0}),10)}}},{key:"toggleFullPage",value:function(e){var t={pageKey:this.currentPageKey,fullpage:e?"true":"false",project:void 0,result:void 0,datafile:void 0,static:void 0,proxy:void 0};"indexPages"===this.entryType?t.project=this.currentProject.id:"resultPages"===this.entryType?(t.result=this.currentResult.id,t.proxy=!1):"filePages"===this.entryType?t.datafile=this.currentDataFile.id:"staticPages"===this.entryType?(t.datafile=this.currentDataFile.id,t.static=!0):"proxyPages"===this.entryType&&(t.result=this.currentResult.id,t.proxy=!0),this.router.navigate(["/page"],{queryParams:t})}},{key:"requestFullPage",value:function(e){var t=window.innerWidth<1024;this.systemService.toggleNavbar(!e),e?this.systemService.toggleSidebar(!1):t||this.systemService.toggleSidebar(!0)}},{key:"toggleRightSideMenu",value:function(e){var t=this;setTimeout((function(){t.displayRightSideMenu=void 0===e?!t.displayRightSideMenu:!!e}))}},{key:"ngOnDestroy",value:function(){this._subs.forEach((function(e){return e.unsubscribe()}))}}]),e}()).\u0275fac=function(e){return new(e||Dt)(ne.Nb(le.a),ne.Nb(le.c),ne.Nb(ue.a),ne.Nb(se.a),ne.Nb(ie.a),ne.Nb(ce.a),ne.Nb(oe.a))},Dt.\u0275cmp=ne.Hb({type:Dt,selectors:[["bdp-page"]],viewQuery:function(e,t){var r;1&e&&ne.Qc(nt,!0),2&e&&ne.wc(r=ne.cc())&&(t.sandbox=r.first)},decls:4,vars:5,consts:[["class","breadcrumb",4,"ngIf"],[1,"bdp-main-container",3,"resize"],["style","display: block;",3,"currentProject","currentResult","currentDataFile","currentPackages","currentUser","isFullPage","keyOrders","validPages","pageKey","entryType","mode","pageChange","requestNavigation","requestFullPage","rightSideMenuStateChange","modeChage",4,"ngIf"],["class","chi-right-menu",4,"ngIf"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],[3,"routerLink",4,"ngIf"],["class","breadcrumb-item active",4,"ngIf"],[1,"breadcrumb-item","active"],[4,"ngIf"],[1,"text-muted"],["target","_blank",3,"routerLink"],[1,"fas","fa-external-link-alt","fa-fw","ml-2"],[2,"display","block",3,"currentProject","currentResult","currentDataFile","currentPackages","currentUser","isFullPage","keyOrders","validPages","pageKey","entryType","mode","pageChange","requestNavigation","requestFullPage","rightSideMenuStateChange","modeChage"],["sandbox",""],[1,"chi-right-menu"],[1,"chi-rbtn",3,"click"],["class","fa fa-angle-right fa-fw",4,"ngIf"],["class","fa fa-angle-left fa-fw",4,"ngIf"],[1,"chi-rbtn-content","ml-2"],[1,"chi-rbtn-arrow"],["aria-hidden","true",1,"fas","fa-arrow-left","fa-fw"],[1,"chi-rbtn-content"],["aria-hidden","true",1,"fas","fa-arrow-right","fa-fw"],["aria-hidden","true",1,"fas","fa-expand","fa-fw"],["aria-hidden","true",1,"fas","fa-sync-alt","fa-fw"],[1,"fas","fa-th-large","fa-fw"],[1,"fas","fa-fw"],[1,"fa","fa-angle-right","fa-fw"],[1,"fa","fa-angle-left","fa-fw"]],template:function(e,t){1&e&&(ne.Ic(0,St,16,12,"ol",0),ne.Tb(1,"div",1),ne.bc("resize",(function(e){return t.onResize(e)}),!1,ne.zc),ne.Ic(2,It,2,11,"bdp-sandbox",2),ne.Sb(),ne.Ic(3,jt,52,25,"div",3)),2&e&&(ne.mc("ngIf",!t.isFullPage),ne.Ab(1),ne.Hc("padding",t.isFullPage?"0px":"7px"),ne.Ab(1),ne.mc("ngIf",t.canInitialize&&t.currentProject&&t.currentPackages&&t.currentUser),ne.Ab(1),ne.mc("ngIf",t.displayRightSideMenu))},directives:[i.n,le.f,rt],styles:[""],data:{animation:[ge.a]}}),Dt),Ot=r("MKys"),Mt=le.g.forChild([{path:"",component:Kt}]),$t=[Ot.a],_t=((Rt=function e(){_classCallCheck(this,e)}).\u0275mod=ne.Lb({type:Rt}),Rt.\u0275inj=ne.Kb({factory:function(e){return new(e||Rt)},providers:[$t],imports:[[i.c,s.d,u.b,l.g,c.c,o.b,fe,Mt]]}),Rt)}}]);