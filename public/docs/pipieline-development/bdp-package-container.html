

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build a package container of Bio-Data Processor &mdash; Big Data Processor  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Big Data Processor
          

          
            
            <img src="../_static/bdp-logo-dark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.8.beta
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Fundamentals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/terms.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/privilege.html">Privilege</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/system-architecture.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fundamentals/task-adapter.html">Task Adapter</a></li>
</ul>
<p class="caption"><span class="caption-text">Workflow Playbook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workflow-playbook/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-playbook/quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-playbook/basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-playbook/filter-functions.html">Filter Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-playbook/example.html">An Example on BDP</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial-full-step-pipelines.html">Full steps to construct a pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial-task-deploy-GCP.html">Task deployment on Google Cloud Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/mongodb-non-root-installation.html">Non-root MongoDB Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">System Administrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../administration/allow-google-sign-in.html">Enable Google 3rd party sign-in</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Big Data Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Build a package container of Bio-Data Processor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/pipieline-development/bdp-package-container.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-a-package-container-of-bio-data-processor">
<h1>Build a package container of Bio-Data Processor<a class="headerlink" href="#build-a-package-container-of-bio-data-processor" title="Permalink to this headline">¶</a></h1>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<div class="line-block">
<div class="line"><strong>Targeted readers</strong>: pipeline developers.</div>
</div>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document explains how tasks/pipeline(s) are packaged into a docker image for Bio-Data Processor. We provided a starter template that allows you to easily pack all your code into a docker image. You may need basic knowledge of unix-based command line, basic knowledge of Docker, or how command line tools are used, but i think this is not mandatory. I wrote this document for developers to easily do packaging. Then, the package can be easily shipped to the Bio-Data Processor and ready to use.</p>
<p>Let’s start explaining how the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> is written.</p>
<div class="section" id="bring-your-development-environment-close-to-the-production-environment">
<h3>Bring your development environment close to the production environment<a class="headerlink" href="#bring-your-development-environment-close-to-the-production-environment" title="Permalink to this headline">¶</a></h3>
<p>It is recommended to wrap your own scripts inside a container. Thus, you can test and develop your scripts in this container. Once it is successful, it nearly guarantees that this container can be deployed everywhere of production environments. No need to install all the required libraries or packages again!</p>
</div>
</div>
<div class="section" id="base-image">
<h2>1. Base Image<a class="headerlink" href="#base-image" title="Permalink to this headline">¶</a></h2>
<p>We use the <a class="reference external" href="https://biocontainers.pro/">biocontainers</a> as our base image. You may see <a class="reference external" href="https://hub.docker.com/r/biocontainers/biocontainers/~/dockerfile/">their Dockerfile</a>.
The following instruction shows that our package image is based on the <code class="docutils literal notranslate"><span class="pre">bioconductors/bioconductions</span></code> image.</p>
<div class="highlight-Docker notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">biocontainers/biocontainers:latest</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">biocontainers/biocontainers</span></code> image is built on top of <code class="docutils literal notranslate"><span class="pre">ubuntu:16.04</span></code>. All modifications can be traced back based on its <cite>dockerfile</cite>.
It creates an account <cite>biodocker</cite> and installed several useful tools such as <cite>conda</cite> for developers to install their dependent packages/libraries.</p>
</div>
<div class="section" id="metadata">
<h2>2. Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h2>
<p>Just as the biocontainers recommended but it is optional.</p>
<div class="highlight-Docker notranslate"><div class="highlight"><pre><span></span><span class="k">LABEL</span> base.image<span class="o">=</span><span class="s2">&quot;biocontainers:latest&quot;</span> <span class="se">\</span>
  <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="se">\</span>
  <span class="nv">software</span><span class="o">=</span><span class="s2">&quot;bdp-template&quot;</span> <span class="se">\</span>
  software.version<span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span> <span class="se">\</span>
  <span class="nv">description</span><span class="o">=</span><span class="s2">&quot;This is a template for building Bio-Data Processor Packages with docker.&quot;</span> <span class="se">\</span>
  <span class="nv">website</span><span class="o">=</span><span class="s2">&quot;https://github.com/bcgsc/bdp-package-template&quot;</span> <span class="se">\</span>
  <span class="nv">documentation</span><span class="o">=</span><span class="s2">&quot;https://github.com/bcgsc/bdp-package-template&quot;</span> <span class="se">\</span>
  <span class="nv">license</span><span class="o">=</span><span class="s2">&quot;https://github.com/bcgsc/bdp-package-template&quot;</span> <span class="se">\</span>
  <span class="nv">tags</span><span class="o">=</span><span class="s2">&quot;bdp-package-template&quot;</span>
  <span class="nv">maintainer</span><span class="o">=</span><span class="s2">&quot;Chi Yang &lt;chiyang1118@gmail.com&gt;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="install-required-packages-libraries-that-needs-root-privileges">
<h2>3. Install required packages/libraries that needs root privileges<a class="headerlink" href="#install-required-packages-libraries-that-needs-root-privileges" title="Permalink to this headline">¶</a></h2>
<p><strong>[The installation of `nodejs` is required. for our docker-wrapper to work.]</strong>
The following snippet in the <cite>dockerfile</cite> file instructs the Docker to build your image with the instructions.
The <cite>RUN</cite> instruction shows you to install the latest NodeJS version. Using the latest NodeJS is preferred for using the <code class="docutils literal notranslate"><span class="pre">bdp-docker-wrapper</span></code>, which is a wrapper function to wrap all your tasks.</p>
<p>You may also install other packages/scripts that require root privileges.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The dockerfile reference: <a class="reference external" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
</div>
<div class="highlight-Docker notranslate"><div class="highlight"><pre><span></span><span class="k">USER</span><span class="s"> root</span>
<span class="k">ENV</span> <span class="nv">NODE_PATH</span><span class="o">=</span>/usr/lib/node_modules
<span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    curl -sL https://deb.nodesource.com/setup_10.x <span class="p">|</span> bash - <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apt-get install -y nodejs <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apt-get purge --auto-remove -y curl
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can see the commands after the <cite>RUN</cite> instructions as if you are using the Linux operation system.
Instead of using multiple RUN instructions, using <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span> <span class="pre">\</span></code> to organize multiple commands into multi-lines. This will reduce the layers of cached images.
use <code class="docutils literal notranslate"><span class="pre">'\'</span></code> to split one long line of a command into multi-lines.</p>
</div>
</div>
<div class="section" id="install-required-packages-libraries-that-need-not-root-privileges">
<h2>4. Install required packages/libraries that need NOT root privileges<a class="headerlink" href="#install-required-packages-libraries-that-need-not-root-privileges" title="Permalink to this headline">¶</a></h2>
<p><strong>[Optional, you need to setup the depedent libraries/packages for your code/library to work]</strong>
Because the <cite>biocontainers</cite> image has created a user account <code class="docutils literal notranslate"><span class="pre">biodocker</span></code>, we take this user as our file owner. It’s best to execute scripts without root privileges unless it’s necessary.
The following snippet showing how to switch the user to <cite>biodocker</cite> (from <cite>root</cite>).</p>
<div class="highlight-Docker notranslate"><div class="highlight"><pre><span></span><span class="k">USER</span><span class="s"> biodocker</span>
</pre></div>
</div>
<p>The followings show four ways to install the required packages:</p>
<div class="section" id="when-the-tools-are-already-in-conda">
<h3>When the tools are already in <cite>conda</cite><a class="headerlink" href="#when-the-tools-are-already-in-conda" title="Permalink to this headline">¶</a></h3>
<p>Because the <code class="docutils literal notranslate"><span class="pre">Biocontainers</span></code> image has already set default conda channels <code class="docutils literal notranslate"><span class="pre">r</span></code> and <code class="docutils literal notranslate"><span class="pre">bioconda</span></code>, you can directly use these channels.
Or you may need the <code class="docutils literal notranslate"><span class="pre">-c</span></code> argument to specify the channel. (e.g. <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">nodejs</span></code>)</p>
<p>You may also find other conda packages from the <a class="reference external" href="https://anaconda.org/">anaconda website</a>.</p>
<div class="highlight-Docker notranslate"><div class="highlight"><pre><span></span><span class="k">RUN</span> conda install r-base<span class="o">=</span><span class="m">3</span>.3.2 <span class="se">\</span>
                  <span class="nv">samtools</span><span class="o">=</span><span class="m">1</span>.4 <span class="se">\</span>
                  <span class="nv">bwa</span><span class="o">=</span><span class="m">0</span>.7.15 <span class="se">\</span>
                  <span class="nv">fastqc</span><span class="o">=</span><span class="m">0</span>.11.5 <span class="se">\</span>
                  cutadapt
</pre></div>
</div>
<p>Although it is optional, but is best to specify the version of these required packages/libraries.</p>
</div>
<div class="section" id="when-the-tools-need-to-be-downloaded-from-internet">
<h3>When the tools need to be downloaded from internet<a class="headerlink" href="#when-the-tools-need-to-be-downloaded-from-internet" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">curl</span></code> or <code class="docutils literal notranslate"><span class="pre">wget</span></code> to retrieve contents from internet.
Remember to clean unneeded files that do not need after installation.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">RUN</span> mkdir -p /tmp/trim_galore <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">cd</span> /tmp/trim_galore <span class="o">&amp;&amp;</span> <span class="se">\</span>
    wget http://www.bioinformatics.babraham.ac.uk/projects/trim_galore/trim_galore_v0.4.3.zip <span class="o">&amp;&amp;</span> <span class="se">\</span>
    unzip /tmp/trim_galore/trim_galore_v0.4.3.zip <span class="o">&amp;&amp;</span> <span class="se">\</span>
    mv trim_galore /home/biodocker/bin/trim_galore <span class="o">&amp;&amp;</span> <span class="se">\</span>
    rm -rf /tmp/trim_galore
</pre></div>
</div>
</div>
<div class="section" id="build-from-the-source-code">
<h3>Build from the source code<a class="headerlink" href="#build-from-the-source-code" title="Permalink to this headline">¶</a></h3>
<p>The following code block demonstrates an example to download the compressed source code. You need to decompress the file(s) and then build the executable from source codes. You may keep only the binary executable files. You might want to set the file to be executable by setting <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">755</span> <span class="pre">your-executable-file</span></code>. Remember to remove all unneeded files.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">RUN</span> <span class="nb">cd</span> /tmp <span class="o">&amp;&amp;</span> wget http://search.cpan.org/CPAN/authors/id/T/TI/TIMB/DBI-1.636.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    tar zxvf DBI-1.636.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">cd</span> /tmp/DBI-1.636 <span class="o">&amp;&amp;</span> <span class="se">\</span>
    perl Makefile.PL <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make <span class="nb">test</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make install <span class="o">&amp;&amp;</span> <span class="se">\</span>
    rm -rf /tmp/DBI-1.636 <span class="o">&amp;&amp;</span> <span class="se">\</span>
    rm -f /tmp/DBI-1.636.tar.gz
</pre></div>
</div>
</div>
<div class="section" id="copy-the-scripts-or-files-from-other-third-party-library">
<h3>Copy the scripts or files from other third party library<a class="headerlink" href="#copy-the-scripts-or-files-from-other-third-party-library" title="Permalink to this headline">¶</a></h3>
<p>You may arrange files into your own file structures. It is possible to directly copy files to the package container. Putting your files inside <cite>/home/biodocker/</cite> directory since this is the default home directory.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">COPY</span> --chown<span class="o">=</span>biodocker:biodocker <span class="o">[</span><span class="s2">&quot;./scripts-inside-container&quot;</span>, <span class="s2">&quot;/home/biodocker/scripts/&quot;</span><span class="o">]</span>
</pre></div>
</div>
<p>More information about the <a class="reference external" href="https://docs.docker.com/engine/reference/builder/#copy">COPY instructions can be found</a>.</p>
</div>
<div class="section" id="install-packages-via-package-manager-s-that-do-not-need-the-root-privilege">
<h3>Install packages via package manager(s) that do not need the root privilege<a class="headerlink" href="#install-packages-via-package-manager-s-that-do-not-need-the-root-privilege" title="Permalink to this headline">¶</a></h3>
<p>If your scripts require <code class="docutils literal notranslate"><span class="pre">npm</span></code> packages and a <cite>package.json</cite> is provided in the folder <cite>/home/biodocker/scripts</cite>, you may need to run <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> inside that folder.
In fact, you may install required packages/libraries as if you are using a linux system. For example, use <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> to install python packages may be suitable for your needs.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">RUN</span> <span class="nb">cd</span> /home/biodocker/scripts <span class="o">&amp;&amp;</span> <span class="se">\</span>
    npm install <span class="o">&amp;&amp;</span> <span class="se">\</span>
    npm cache clean
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-bdp-package-folder-is-required-and-contains-the-following-folders">
<h2>5. The <cite>bdp-package</cite> folder is required and contains the following folders<a class="headerlink" href="#the-bdp-package-folder-is-required-and-contains-the-following-folders" title="Permalink to this headline">¶</a></h2>
<p><strong>[Required, Don’t change]</strong>
During package installation, this <code class="docutils literal notranslate"><span class="pre">bdp-package</span></code> folder will be copied to the host.
There are five sub-folders in the <code class="docutils literal notranslate"><span class="pre">./bdp-package</span></code></p>
<ul class="simple">
<li><p><strong>client</strong>: All client-side scripts (mainly for interactive data visualization, haven’t implemented yet :p)</p></li>
<li><p><strong>configs</strong>: If you need some post-installing configurations, files in the <cite>bdp-package/configs</cite> can be accessed through <cite>/config/configs</cite> at run-time. The contents of this folder are firstly copied to the BDP host and might be modified by BDP to different configurations, e.g. the cpu cores, memory size or other task configurations, etc. Then, the modified configurations can be accessed during run-time via <cite>/config/configs</cite> folder.</p></li>
<li><p><strong>db</strong>: All database-related files can be put here. The main required bdp-package.json can be automatically created online. You can simply download from BDP once your tasks are defined on BDP.</p></li>
<li><p><strong>scripts</strong>: All external scripts which can be directly called from your Bio-Data Process host. You may write your task-index.yaml and task-templates for your tasks. Our <cite>task-portal.js</cite> will magically understand your tasks so that tasks can be executed through BDP web pages.</p></li>
<li><p><strong>data</strong>: Additional data can be put here. The future plan is to include some demo/testing datasets in this folder for the demonstration purpose (not yet implemented).</p></li>
</ul>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">COPY</span> --chown<span class="o">=</span>biodocker:biodocker <span class="o">[</span><span class="s2">&quot;./bdp-package&quot;</span>, <span class="s2">&quot;/home/biodocker/bdp-package&quot;</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-docker-wrapper">
<h2>6. The docker-wrapper<a class="headerlink" href="#the-docker-wrapper" title="Permalink to this headline">¶</a></h2>
<p><strong>[Required, Don’t change]</strong></p>
<p>The <cite>docker-wrapper.js</cite> and <cite>bdp-tasks.yaml</cite> are required. You do NOT change the <cite>docker-wrapper.js</cite> which will be executed everytime this package container is initiated. Then, it guards valid actions taht are defined in <cite>bdp-tasks.yaml</cite>. Invalid actions will be rejected and the process will be stopped.</p>
<p>Please fill the task definitions in the bdp-tasks.yaml. This file is always located in the home directory <cite>/home/biodocker</cite>. <strong>Only the tasks with the valid action names can be performed</strong>. The required information includes the <strong>executable path</strong>, <strong>the scripts</strong> and <strong>all required arguments</strong>.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="c"># Copy the `docker-wrapper.js` and `bdp-tasks.yaml` into the home directory.</span>
<span class="k">COPY</span> --chown<span class="o">=</span>biodocker:biodocker <span class="o">[</span><span class="s2">&quot;./docker-wrapper.js&quot;</span>, <span class="s2">&quot;./bdp-tasks.yaml&quot;</span>, <span class="s2">&quot;/home/biodocker/&quot;</span><span class="o">]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Configuring the <code class="docutils literal notranslate"><span class="pre">bdp-tasks.yaml</span></code> file.</p>
</div>
</div>
<div class="section" id="switch-back-to-root-user">
<h2>7. Switch back to root user<a class="headerlink" href="#switch-back-to-root-user" title="Permalink to this headline">¶</a></h2>
<p><strong>[Required, Don’t change]</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">docker-wrapper</span></code> needs the root privilege to change the user id and group id of the user <code class="docutils literal notranslate"><span class="pre">biodocker</span></code> to the external host user’s <code class="docutils literal notranslate"><span class="pre">uid</span></code> and <code class="docutils literal notranslate"><span class="pre">gid</span></code>.</p>
<p>It is relatively safe that all the tasks inside the image will be executed by this <code class="docutils literal notranslate"><span class="pre">biodocker</span></code> user.
This prevents the file owner issues for the output files. Despite that the user is switched to <code class="docutils literal notranslate"><span class="pre">root</span></code>, the task will be performed on behave of the user <code class="docutils literal notranslate"><span class="pre">biodocker</span></code>.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">USER</span><span class="s"> root</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-the-entrypoint">
<h2>8. Setting the ENTRYPOINT<a class="headerlink" href="#setting-the-entrypoint" title="Permalink to this headline">¶</a></h2>
<p><strong>[Required, Don’t change]</strong>
Once this docker package container is initiated, the user id and group id will be set as the external host user to prevent producing files of root owner. This is done by <code class="docutils literal notranslate"><span class="pre">docker-wrapper</span></code>.
The <code class="docutils literal notranslate"><span class="pre">docker-wrapper.js</span></code> will automatically execute the <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">/home/biodocker/docker-wrapper.js</span></code> and do the aforementioned user/group id changing.
Also, it will check whether the task name has been specified. If not, the process will be terminated.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;/home/biodocker/docker-wrapper.js&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="building-from-dockerfile">
<h2>9. Building from Dockerfile<a class="headerlink" href="#building-from-dockerfile" title="Permalink to this headline">¶</a></h2>
<p>In the directory where the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> locates, call <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">'your-docker-image-name'</span> <span class="pre">.</span></code>. (Don’t forget the last <code class="docutils literal notranslate"><span class="pre">.</span></code> in your command, that specifies the Dockerfile locations, which is the current working directory <code class="docutils literal notranslate"><span class="pre">.</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is recommended to use <a class="reference external" href="https://gitlab.com/">gitlab</a> to save your scripts as well as the container registry. It is free for personal use.</p>
</div>
</div>
<div class="section" id="testing-your-script">
<h2>10. Testing your script<a class="headerlink" href="#testing-your-script" title="Permalink to this headline">¶</a></h2>
<p>In order to test whether your tasks can work as expected, You may comment the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> line (see below) and then call <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">--rm</span> <span class="pre">-it</span> <span class="pre">your-docker-image-name</span></code>.
This will let you log-in to that docker container as if you are using the linux operating system, since the base image is biocontainers which base image is ubuntu 16.04.</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="c"># Comment the ENTRYPOINT so that you can log in to the linux.</span>
<span class="c">#ENTRYPOINT [&quot;node&quot;, &quot;/home/biodocker/docker-wrapper.js&quot;]</span>
</pre></div>
</div>
<div class="section" id="volume-mapping-from-host-folders-to-docker-containers">
<h3>Volume mapping from host folders to docker containers<a class="headerlink" href="#volume-mapping-from-host-folders-to-docker-containers" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://docs.docker.com/engine/reference/run/#volume-shared-filesystems">VOLUME mapping</a> is <strong>automatically processed</strong> in Bio-Data Processor.
Based on the biocontainers, the <code class="docutils literal notranslate"><span class="pre">/data</span></code> and <code class="docutils literal notranslate"><span class="pre">/config</span></code> folders can be mapped to external volumes.
The <code class="docutils literal notranslate"><span class="pre">/data</span></code> in Bio-Data Processor will be automatically mapped as the <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">folder</span></code>,
while the <code class="docutils literal notranslate"><span class="pre">/config</span></code> folder is the <code class="docutils literal notranslate"><span class="pre">Package</span> <span class="pre">folder</span></code>.
This means you may access <code class="docutils literal notranslate"><span class="pre">/config/configs</span></code> to find some configuration files inside docker container at run time.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>To fully understand how to map volumes between hosts and containers, please read the <a class="reference external" href="https://docs.docker.com/engine/reference/run/">docker run reference</a> (the <code class="docutils literal notranslate"><span class="pre">-v</span></code> part).</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A more convenient way is to map folders that contain your scripts to a path inside container as the follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker run -v your-script-folder-path:/home/biodocker/scripts -it --rm your-docker-image-name
</pre></div>
</div>
<p>In this way, you can directly edit your scripts on your host and instantly test them inside container using the interactive tty mode (the <code class="docutils literal notranslate"><span class="pre">-it</span></code> option in the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command).</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Chi Yang

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>